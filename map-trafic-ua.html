<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo-UA-map</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Pacifico&family=Roboto+Slab:wght@100..900&family=Sofia+Sans:ital,wght@1,1..1000&family=Ysabeau+SC:wght@1..1000&display=swap" rel="stylesheet">
    
   
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            
            height: 100%;
            width: 100%;
            /*font-family: 'Open Sans', sans-serif !important;*/
            font-family: "Balsamiq Sans", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        .export-import-tooltip{
            background-color: rgba(255, 255, 128, .5);
            
        }
        .imp-exp-block{
            display: flex;
            align-items: center;
            align-content: center;
            flex-direction: column;
            background-color: white; ;
            margin-top: 30%;
        }
        .leaflet-control{
            
            background: white;
            border: none !important;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px !important;
        }
        .leaflet-control-layers-list{
            margin: 5px;
        }
        .leaflet-control-layers-list .leaflet-layerstree-header:hover{
            /*text-decoration: underline;*/
            background-color: rgb(240, 240, 240);
            cursor: pointer;
        }
        .leaflet-control-layers {
            transition: max-height 1s ease-out, opacity 0.3s ease-out;
            max-height: 20vh; 
            overflow: hidden;
            opacity: 1;
            }

            .leaflet-control-layers:hover {
            max-height: 100vh; 
            opacity: 1;
            }
        
        /*-------------------legend---------------*/

        .leaflet-legend {
            background: white;
            padding: 5px;
            margin: 10px;
            max-width: 210px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;        
            align-content: center;
            justify-content: center;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            /* Вирівнювання по центру */
            gap: 8px; /* Відступ між іконкою та текстом */

        }

        .legend-icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }


        .leaflet-legend .l750{
            background: #ba1806;
        }
        .leaflet-legend .l400{
            background: #f505fa;
        }
        .leaflet-legend .l330{
            background: #0572a1;
        }
        .leaflet-legend .l220{
            background: green;
        }
        .leaflet-legend .l110{
            background: #b89023;
        }
        
        .leaflet-legend div{
            display: flex;
            flex-direction: row;
            margin: 5px;
        }

        .leaflet-legend i {
            min-width: 18px;
            min-height: 18px;
            max-width: 18px;
            max-height: 18px;
            float: left;
            margin-right: 8px;
            
            opacity: 0.7;
        }
        .leaflet-legend .ves {
            background: green;
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .p35 {
            background: rgb(1, 33, 172);
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .z700 {
            background: rgba(15, 207, 207, 0.479);
            border-radius: 50%;
            border: 2px solid rgb(0, 247, 255);
        }
        .leaflet-legend .ses {
            background: yellow;
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .uze{
            background: #a92dad;
            border-radius: 50%;
            border: 2px solid purple;
        }
        .leaflet-legend .all{
            background: gray;
            border-radius: 50%;
            border: 2px solid black;
        }
        .custom-tooltip {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid black;
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .transperent{
            background-color: #0572a1;
        }
        .leaflet-tooltip.custom-tooltip1{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip1:before {
            display: none !important; /* Вимикає стрілочку */
        }
        .leaflet-tooltip.custom-tooltip110{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip110:before {
            display: none !important; /* Вимикає стрілочку */
        }
        .info-control {
            padding: 10px 13px;
            border-radius: 2px;
        }
        .info-control:hover {
            cursor: pointer;
        }
        .legend i {
            display: inline-block;
            width: 20px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid black;
        }

        .layer-measureboundary {
    stroke: red !important; /* Червоний колір */
    stroke-width: 4px !important; /* Товщина */
    opacity: 0.8 !important; /* Прозорість */
}

/* Стилізація кінцевої лінії (результат вимірювання) */
.layer-measure-resultline {
    stroke: rgb(255, 0, 0) !important; /* Синій колір */
    stroke-width: 4px !important; /* Товщина */
    opacity: 1 !important;
}

/* Стилізація площі вимірювання */
.layer-measure-resultarea {
    fill: rgba(192, 70, 77, 0.3) !important; /* Прозорий зелений */
    stroke: rgb(255, 0, 0) !important; /* Обведення зелене */
    stroke-width: 4px !important;
}

/* Стилізація точок вимірювання */
.layer-measurevertex {
    fill: rgb(255, 0, 0) !important;
    stroke: black !important;
    stroke-width: 4px;
    r: 6px; /* Радіус точки */
}

.leaflet-pm-text {
    font-size: 20px;  /* Задайте бажаний розмір шрифту */
    font-weight: bold; /* Можна також змінити товщину шрифту */
    color: red; /* Колір шрифту */
}
.leaflet-bottom{
    position: absolute; 
    z-index:600 !important;
}

.leaflet-control-layers-list::-webkit-scrollbar {
    width: 8px; /* Товщина скролбару */
}

/* Колір фону скролбару */
.leaflet-control-layers-list::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-radius: 10px;
}

/* Колір та вигляд повзунка */
.leaflet-control-layers-list::-webkit-scrollbar-thumb {
    background: #3a3a3a;
    border-radius: 10px;
}

/* При наведенні змінюємо колір */
.leaflet-control-layers-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}

input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  background-color: transparent;
  margin: 0;

  font: inherit;
  color: currentColor;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 0.15em;
  transform: translateY(-0.075em);

  display: grid;
  place-content: center;
}
:root {
  --form-control-color: rgb(0, 0, 0);
  --form-control-disabled: #959495;
}
.leaflet-layerstree-header-label{
    display: inline-flex;
    align-items: center;
    gap: 0.5em; /* Відступ між чекбоксом і текстом */
    cursor: pointer;
}
.leaflet-layerstree-header-name b{
    font-size: 1.15em;
}
input[type="checkbox"] {
  appearance: none; /* Прибирає стандартний стиль */
  display: inline-flex; /* Замість inline-block, щоб працював ::before */
  align-items: center; /* Вирівнювання */
  justify-content: center;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 0.15em;
  vertical-align: middle; /* Вирівнює з текстом */
  margin-right: 0.5em; /* Відступ від тексту */
  position: relative; /* Важливо для ::before */
}

input[type="checkbox"]::before {
  content: "";
  width: 0.75em;  /* Збільшений розмір */
  height: 0.75em;
  clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
  transform: scale(0);
  transform-origin: bottom left;
  transition: 120ms transform ease-in-out;
  box-shadow: inset 1em 1em var(--form-control-color);
  background-color: CanvasText;
}

input[type="checkbox"]:checked::before {
  transform: scale(1);
}

input[type="checkbox"]:focus {
  outline: max(2px, 0.15em) solid currentColor;
  outline-offset: max(2px, 0.15em);
}

input[type="checkbox"]:disabled {
  --form-control-color: var(--form-control-disabled);
  color: var(--form-control-disabled);
  cursor: not-allowed;
}

input[type="radio"] {
  appearance: none;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 50%; /* Робить кнопку круглою */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 0.5em;
  position: relative;
  vertical-align: middle;
}

input[type="radio"]::before {
  content: "";
  position: absolute;
  width: 0.65em;
  height: 0.65em;
  background-color: var(--form-control-color);
  border-radius: 50%;
  transform: scale(0);
  transition: 120ms transform ease-in-out;
}

input[type="radio"]:checked::before {
  transform: scale(1);
}

.wind-legend {
  opacity: 0; /* Початково приховано */
  transform: translatex(-20px); /* Легка анімація появи знизу */
  transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
}

.wind-legend.show {
  opacity: 1;
  transform: translateY(0);
}
        
    </style>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyAQpI0dCWKbXACbnNi445Hro26SzrlsGdU",
            authDomain: "my-map-pj-54751.firebaseapp.com",
            projectId: "my-map-pj-54751",
            storageBucket: "my-map-pj-54751.firebasestorage.app",
            messagingSenderId: "349429907738",
            appId: "1:349429907738:web:8a6d42bfeaf8eb0b612ca3",
            measurementId: "G-T4XGCQ6PDH"
        };
    
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
    
        // Перевірка стану користувача
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // Якщо користувач не авторизований, перенаправляємо на сторінку входу
                window.location.href = "https://mark-000.github.io/pl-power-vis-map.github.io/login.html";
            } else {
                console.log("User is logged in:", user.email);
                // Тут можна показати дані користувача на сторінці
            }
        });
    
        // Обробка кнопки виходу
    
    </script>
    
    <div id="map"></div>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iso8601-js-period@0.2.1/iso8601.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://unpkg.com/esri-leaflet/dist/esri-leaflet.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://jjimenezshaw.github.io/Leaflet.Control.Layers.Tree/L.Control.Layers.Tree.js"></script>

    
    
    <!-- JavaScript для MarkerCluster -->
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <!--line-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css" />
    <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>
    <!--tiffff-->
    <script src="https://cdn.jsdelivr.net/npm/georaster@1.6.0/dist/georaster.browser.bundle.min.js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rainbowvis.js@1.1.1/rainbowvis.js"></script>
    <script src="https://unpkg.com/geoblaze"></script>
    <!--derevo-->
    <link rel="stylesheet" href="L.Control.Layers.Tree.css">
    <script src="L.Control.Layers.Tree.js"></script>

    <!-- draw tool-------->
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
    <!--poligon pattern-->
<!-- Підключення стилю плагіна Leaflet.Pattern -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-pattern/0.0.6/leaflet.pattern.min.css" />

    <!-- Підключення самого плагіна Leaflet.Pattern -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-pattern/0.0.6/leaflet.pattern.min.js"></script>
     <!-- глобус -->
    <script src="https://unpkg.com/leaflet-globes"></script>
    <script>
        // URLs для GeoJSON файлів
       

        // Створення карти
    var map = L.map('map', {
        zoomControl: false, // Ховаємо контрол зуму, щоб не заважав анімації
        attributionControl: false, // Приховуємо атрибуцію
        center: [20, 0], // Початковий вигляд на глобус
        zoom: 2,
        globeView: true // Активуємо режим глобуса
    });

    var osmLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);

    // Затримка для анімації - обертання глобуса
    setTimeout(() => {
        map.flyTo([49.763967421708514, 27.982313845924605], 7, { // Задаємо координати та зум
            animate: true,
            duration: 3 // Тривалість анімації
        });
    });

        var legend = L.control({ position: 'bottomleft' });

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'leaflet-legend');
            
                            div.innerHTML = `
                                <div><i class="l750"></i>АЕС</div>
                                <div><i class="l110"></i>ТЕС</div>
                                <div><i class="l330"></i>ГЕС</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#8B1A10" d="M200-440v-80h560v80H200Z"/></svg>750 кВ</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#EA33F7" d="M200-440v-80h560v80H200Z"/></svg> 400 кВ</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#2854C5" d="M200-440v-80h560v80H200Z"/></svg> 330 кВ</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#48752C" d="M200-440v-80h560v80H200Z"/></svg> 220 кВ</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#EAC452" d="M200-440v-80h560v80H200Z"/></svg> 110 кВ</div>
                                <div><i class="z700"></i> СЗЗ</div>
                                <div><i class="uze"></i> ВЕС конкурентів</div>
                                <div><i class="ves"></i> Доступна потужність 110 кВ</div>
                                <div><i class="p35"></i> Доступна потужність 35 кВ</div>
                                <div><i class="ses"></i> Доступна потужність із технічними обмеженнями приєднання</div>
                            `;                
            return div;
        };

        // Додавання плиток карти (OpenStreetMap)
       var WhiteLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png');

        

        // Додавання плиток Google Maps
        var googleLayer = L.tileLayer('http://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {
            attribution: 'Google Maps'
        });
        //topo map
        var topoLayer = L.tileLayer('https://tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: 'opentopomap'
        });

    // За замовчуванням буде використовуватися OpenStreetMap
      //  osmLayer.addTo(map);
      var coordDiv = L.control({ position: 'bottomright' });

coordDiv.onAdd = function () {
    var div = L.DomUtil.create('div', 'coordinate-display');
    div.style.padding = '5px';
    div.style.background = 'white';
    div.style.opacity = '0.8';
    div.style.cursor = 'pointer'; // Додаємо стиль для вказівника миші
    div.innerHTML = "Координати:";
    
    // Додаємо подію копіювання при кліку
    div.addEventListener('click', function () {
        const text = div.innerText.replace('Координати:', '').trim();
        navigator.clipboard.writeText(text).then(() => {
            div.innerHTML = `✅ Скопійовано ${text}`;
            setTimeout(updateCenterCoordinates, 1500); // Повертаємо назад через 1.5 секунди
        }).catch(err => console.error("Помилка копіювання:", err));
    });

    return div;
};

coordDiv.addTo(map);

// Функція для оновлення координат центру карти
function updateCenterCoordinates() {
    var center = map.getCenter();
    document.querySelector('.coordinate-display').innerHTML = 
        `${center.lat.toFixed(6)}, ${center.lng.toFixed(6)}`;
}

// Оновлюємо координати при русі карти
map.on('moveend', updateCenterCoordinates);

// Оновлюємо координати при завантаженні
updateCenterCoordinates();


       L.Control.Info = L.Control.extend({
            onAdd: function(map) {
                var container = L.DomUtil.create("div", "info-control");
                container.innerHTML = "ℹ";
                container.title = "Натисніть для інформації";
                
                container.onclick = function() {
                    alert("📌 Для отримання кадастрових даних натисніть правою кнопкою миші на карту.\n📌 Після натискання буде завантажено тайл з кадастровими даними.\n📌 Для очищення карти натисніть на колесико миші.");
                };
        
                return container;
            }
        });

        // Додаємо елемент на карту
        var infoControl = new L.Control.Info({ position: "topleft" });
        map.addControl(infoControl);
//-----------------------------малювання - вимірювання--------------------------------------
        var measureControl = new L.Control.Measure({
            position: "topleft",
            primaryLengthUnit: "meters",
            secondaryLengthUnit: "kilometers", // Одиниці вимірювання
            primaryAreaUnit: "hectares",
            secondaryAreaUnit: "sqmeters",
            showMeasurements: true, // Показує вимірювання ліній
            captureZIndex: 10000,
            measureControlTitle: "Виміряти відстань",
            activeColor: '#ff0000',  // Колір лінії активного вимірювання
            completedColor: '#0000ff'
            
        });

        map.addControl(measureControl);

        
        // Додаємо елемент на карту
        map.pm.addControls({
            position: 'bottomright', // Розташування панелі
            drawCircle: true,
            drawRectangle: false,
            drawPolygon: true, 
            drawMarker: false, // Вимкнути точки
            drawCircleMarker: false, // Вимкнути круглі маркери
            drawText: true, // Вимкнути текст
            measureControl: true,
            editMode: false, // Вимикає режим редагування
            cutPolygon: false,
            rotateMode: false,
        });

        // 4. Включаємо режим вимірювання довжини/площі
        map.pm.setGlobalOptions({
            measureControl: true,  // Додає кнопку вимірювання
            allowSelfIntersection: true, // Вимикає перетин самих себе
            cutPolygon: false, // Вимикає вирізання полігонів
            editMode: false,
            rotateMode: false,
            snappable: false,
        });

        map.pm.setPathOptions({
            color: 'red',        // Колір ліній
            fillColor: 'red',   // Колір заповнення полігонів
            fillOpacity: 0,    // Прозорість полігонів
            weight: 2           // Товщина ліній
        });

        let distanceTooltip;
    
        map.on('pm:drawstart', function (e) {
            if (e.workingLayer instanceof L.Polyline) {
                let totalDistance = 0;
                let lastLatLng = null;

                e.workingLayer.on('pm:vertexadded', function (event) {
                    let latlngs = e.workingLayer.getLatLngs();
                    let currentLatLng = latlngs[latlngs.length - 1]; 

                    if (lastLatLng !== null) {
                        totalDistance += lastLatLng.distanceTo(currentLatLng);
                    }
                    lastLatLng = currentLatLng;

                    if (distanceTooltip) {
                        map.removeLayer(distanceTooltip);
                    }

                    distanceTooltip = L.tooltip({
                        permanent: false,
                        direction: 'top',
                        className: 'distance-tooltip'
                    })
                        .setLatLng(currentLatLng)
                        .setContent(`${totalDistance.toFixed(2)} м`)
                        .addTo(map);
                });

                map.once('pm:drawend', function () {
                    if (distanceTooltip) {
                        map.removeLayer(distanceTooltip);
                    }
                });
            }
        });




map.on('pm:drawstart', function (e) {
    if (e.workingLayer instanceof L.Circle) {
        let centerLatLng = null;

        // Слухач події для визначення центру кола
        map.on('click', function setCenter(event) {
            centerLatLng = event.latlng; // Встановлюємо центр кола на перше натискання на карту
            map.off('click', setCenter); // Вимикаємо слухача після визначення центру

            // Оновлюємо тултіп під час малювання
            let moveListener = function (event) {
                let currentLatLng = event.latlng;
                let radius = centerLatLng.distanceTo(currentLatLng); // Відстань від центру кола до поточної точки

                // Видаляємо старий тултіп
                if (distanceTooltip) {
                    map.removeLayer(distanceTooltip);
                }

                // Створюємо новий тултіп біля курсора
                distanceTooltip = L.tooltip({
                    permanent: false,
                    direction: 'top',
                    className: 'distance-tooltip'
                })
                    .setLatLng(currentLatLng) // Позиція тултіпа біля курсора
                    .setContent(`Радіус: ${radius.toFixed(2)} м`)
                    .addTo(map);
            };

            map.on('mousemove', moveListener); // Додаємо слухача для події mousemove після встановлення центру

            // Після завершення малювання кола
            map.once('pm:drawend', function () { // Використовуємо `once` для того, щоб обробляти подію тільки один раз
                map.removeLayer(distanceTooltip);
                map.off('mousemove', moveListener); // Вимикаємо оновлення тултіпа після завершення малювання
            });
        });
    }
});

var selectedPolygon = null; // Тут зберігається вибраний полігон

// Додаємо обробник кліку на полігон для вибору
map.on('pm:create', function (e) {
    e.layer.on('click', function () {
        if (selectedPolygon) {
            selectedPolygon.setStyle({ color: 'red' }); // Повертаємо попередній колір
        }
        selectedPolygon = this;
        selectedPolygon.setStyle({ color: 'blue' }); // Виділяємо вибраний полігон
    });
});

// Функція експорту вибраного полігону
function exportSelectedGeoJSON() {
    if (!selectedPolygon) {
        alert("Виберіть полігон, клікнувши на нього!");
        return;
    }

    // Отримуємо GeoJSON
    var geojsonFeature = selectedPolygon.toGeoJSON();
    var geojsonString = JSON.stringify(geojsonFeature, null, 2);

    // Створюємо посилання для завантаження файлу
    var blob = new Blob([geojsonString], { type: "application/json" });
    var link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "selected_polygon.geojson";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Додаємо кнопку для завантаження конкретного полігону
var downloadButton = L.control({ position: "bottomright" });

downloadButton.onAdd = function (map) {
    var div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
    div.innerHTML = '<button style="background:#fff;border:1px solid #ccc;padding:5px 5px;cursor:pointer;">⬇️</button>';
    div.onclick = exportSelectedGeoJSON;
    return div;
};

// Додаємо кнопку на карту


downloadButton.addTo(map);



//-----------------------------будування шарів--------------------------------------    


//-----------------------------електромережі--------------------------------------    
    
//-----------------------------підключення до нек--------------------------------------
        var prelunJsonUrl = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/ukr-pidst.geojson';
        var geoJsonClusterGroup = L.markerClusterGroup({
            spiderfyOnMaxZoom: true, // Розпакування кластерів при максимальному масштабі
            showCoverageOnHover: false, // Відключення області кластеру при наведенні
            zoomToBoundsOnClick: true, // Автозбільшення при кліку на кластер
            spiderLegPolylineOptions: {
                weight: 0,
            },
            spiderfyShapePositions: function (count, centerPt) {
                var radius = 40; // Радіус розташування
                var angleStep = (2 * Math.PI) / count;
                return Array.from({ length: count }, (_, i) => {
                    var angle = i * angleStep;
                    return new L.Point(
                        centerPt.x + radius * Math.cos(angle),
                        centerPt.y + radius * Math.sin(angle)
                    );
                });
            },iconCreateFunction: function (cluster) {
                var sumvmerezu = 0;
                cluster.getAllChildMarkers().forEach(function (marker) {
                    var value1 = marker.feature.properties["Розрахункова потужність (за ТУ), МВт"];
                    if (!isNaN(value1)) {
                        sumvmerezu += parseFloat(Math.round(value1));
                    }
                });
                // Створення іконки
                return L.divIcon({
                    html: `
                        <div style="background-color: rgba(0, 123, 255, 0.6); 
                                    font-size: 15px;
                                    border-radius: 50%; 
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;
                                    flex-direction: column;
                                    width: 50px; 
                                    height: 50px; 
                                    text-align: center; 
                                    color: white; 
                                    font-weight: bold;">
                            <div style="color: black;">${sumvmerezu}</div>
                            
                        </div>
                    `,
                    className: 'custom-cluster-icon',
                    iconSize: [50, 50]
                });
            }
        });

        // Функція для визначення кольору залежно від Rodzaj instalacji
        function getColorByInstallationType(type) {
            if (type === 'СЕС') {
                return 'purple'; // Фіолетовий
            } else if (type === 'ВЕС') {
                return 'blue'; // Синій
            } else if (type === 'УЗЕ') {
                return 'orange'; // Помаранчевий
            } else {
                return 'gray'; // Сірий (для інших значень)
            }
        }

        fetch(prelunJsonUrl)
            .then(response => response.json())
            .then(geojsonData => {
                var gprelunJsonLayer = L.geoJSON(geojsonData, {
                    pointToLayer: function (feature, latlng) {
                    var color = getColorByInstallationType(feature.properties['Вид джерела енергії']);
                    var marker = L.circleMarker(latlng, {
                        radius: 8,
                        fillColor: color,
                        color: color,
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 1
                    });

                    // Додавання підпису
                    marker.bindTooltip(`
                        
                        ${feature.properties['Розрахункова потужність (за ТУ), МВт'] || 'Невідомо'}<br>
                    `, {
                        permanent: true,
                        direction: 'top',
                        className: 'custom-tooltip1'
                    });
                    marker.bindPopup(`
                        <b>ПС 220-750 кВ:</b> ${feature.properties['ПС 220-750 кВ'] || 'Невідомо'}<br>
                        <b>Потужність:</b> ${feature.properties['Розрахункова потужність (за ТУ), МВт'] || 'Невідомо'} МВт<br>
                    `);

                    return marker;
                }
                });
                geoJsonClusterGroup.addLayer(gprelunJsonLayer); 
               //-------------------------------------------------------------------
        var geojsonukrline = "https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/ukr-line-filter-all.geojson"
        fetch(geojsonukrline)
            .then(response => response.json())
            .then(reconsGeojsonData => {
                var reconsLayer = L.geoJSON(reconsGeojsonData, {
                    style: function(feature) {
                        // Логіка для зміни кольору залежно від значення voltage
                        if (feature.properties.voltage && feature.properties.voltage.includes('220')) {
                            return { color: 'green', weight: 2.5, opacity: 1 }; // Зелений для 220
                        } else if (feature.properties.voltage && feature.properties.voltage.includes('400')) {
                            return { color: '#f505fa', weight: 2.5, opacity: 1 }; // Червоний для 400
                        }else if (feature.properties.voltage && feature.properties.voltage.includes('750')) {
                            return { color: '#ba1806', weight: 2.5, opacity: 1 }; // Червоний для 400
                        } else {
                            return { color: '#0572a1', weight: 2.5, opacity: 1 }; // Фіолетовий для всього іншого
                        }
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Назва:</b> ${feature.properties.name || 'Unknown'}<br>
                            <b>Напруга:</b> ${feature.properties.voltage || 'Unknown'}
                        `);
                    }
                });
//-------------------------------------------------------------------
        var geojsonukrline110 = "https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/line-ua-110-150.geojson"
        fetch(geojsonukrline110)
            .then(response => response.json())
            .then(reconsGeojsonData => {
                var Layer110 = L.geoJSON(reconsGeojsonData, {
                    style: function(feature) {
                        // Логіка для зміни кольору залежно від значення voltage
                        if (feature.properties.voltage && feature.properties.voltage.includes('110')) {
                            return { color: '#b89023', weight: 1.5, opacity: 1 }; // Зелений для 220
                        }  else {
                            return { color: '#b89023', weight: 1.5, opacity: 1 }; // Фіолетовий для всього іншого
                        }
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Назва:</b> ${feature.properties.name || 'Unknown'}<br>
                            <b>Напруга:</b> ${feature.properties.voltage || 'Unknown'}
                        `);
                    }
                });
                //-------------------------------------------------------------------
        var geojsonUrlBorder = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Ukraine_Border.geojson';
        map.createPane('borderPane');
               //map.getPane('borderPane').style.zIndex = 400;
                fetch(geojsonUrlBorder)
                    .then(response => response.json())
                    .then(borderGeojsonData => {
                        borderLayer = L.geoJSON(borderGeojsonData, {
                            pane: 'borderPane',
                            style: {
                                color: '#595857', // Колір шару
                                weight: 1, // Товщина ліній
                                fillOpacity: 0
                            },
                            interactive: false
                        });
//-------------------------------------------------------------------
        var geojsonUrlbuffer50kmpidst = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/buffer-for-proekty-50km.geojson';
            //map.getPane('borderPane').style.zIndex = 400;
            fetch(geojsonUrlbuffer50kmpidst)
                .then(response => response.json())
                .then(borderGeojsonData => {
                    buffer50pidstLayer = L.geoJSON(borderGeojsonData, {
                        style: {
                            color: '#f5076a', // Колір шару
                            weight: 2, // Товщина ліній
                            fillOpacity: 0,
                        },
                        interactive: false
                    });
                   //-------------------------------------------------------------------                                     
        var geojsonUrlNEK = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/nek-substations.geojson';
        fetch(geojsonUrlNEK)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                NEKLayer = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, {
                            radius: 6, // Радіус точки
                            fillColor: "black", // Колір заповнення
                            color: "yellow", // Колір обведення
                            weight: 1, // Товщина обведення
                            opacity: 1, // Прозорість обведення
                            fillOpacity: 1 // Прозорість заповнення
                        });
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Підстанція:</b> ${feature.properties.Substation || 'Unknown'}<br>
                            <b>Локація:</b> ${feature.properties.Location || 'Unknown'}<br>
                            <b>Трансформатори:</b> ${feature.properties.Transformers || 'Unknown'}
                        `);
                    }
                });
        var geojsonUrlPUA = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/p-stations-ua.geojson';
        fetch(geojsonUrlPUA)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                PUALayer = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        var size = feature.properties.power / 1500; // Розмір квадрата (можна змінити на потрібний)
                        const size2 = Math.sqrt(size) * 2;
                        // Встановлюємо колір залежно від типу станції
                        var color;
                        switch (feature.properties.type) {
                            case 'АЕС':
                                color = '#8B1A10'; // Червоний для АЕС
                                break;
                            case 'ТЕС':
                                color = '#b89023'; // Жовтий для ТЕС
                                break;
                            case 'ГЕС':
                            case 'ГАЕС':
                                color = '#0572a1'; // Синій для ГЕС або ГЕАС
                                break;
                            default:
                                color = 'black'; // Колір за замовчуванням
                                break;
                        }
                        const squareIcon = L.divIcon({
                            className: 'custom-marker',
                            html: `<div style="
                                width: ${size2 * 15}px;
                                height: ${size2 * 15}px;
                                background-color: ${color};
                                opacity: 0.7;
                                border: 1px solid black;
                                transform: translate(-50%, -50%);
                                box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
                            "></div>`,
                            iconSize: [size * 17, size * 17], // Можна підлаштувати розміри
                            iconAnchor: [size, size], // Центрування іконки
                        });
                        return L.marker(latlng, { icon: squareIcon });
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b style='font-size: 15px;'> ${feature.properties.station || 'Unknown'}</b><br>
                            <b>Тип:</b> ${feature.properties.type || 'Unknown'}<br>
                            <b>Потужність:</b> ${feature.properties.power || 'Unknown'} МВт
                        `);
                    }
                });


        var geojsonUrlNEK = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/nek-pidstancii-pidkluch.geojson';
        fetch(geojsonUrlNEK)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Шар для potuznist35
                var layerPotuznist35 = L.geoJSON(projektyGeojsonData, {
                    filter: function(feature) {
                        return feature.properties.potuznist35 != null && feature.properties.potuznist35 > 0;
                    },
                    pointToLayer: function(feature, latlng) {
                        let power = feature.properties.potuznist35;
                        let marker = L.circleMarker(latlng, {
                            radius: Math.sqrt(power) * 1.2, // Розмір точки залежить від потужності
                            fillColor: "blue",
                            color: "black",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                        let tooltipOffset = -Math.sqrt(power) * 1.2; 
                        marker.bindTooltip(`${power}`, {
                            permanent: true,
                            direction: 'top',
                            className: 'custom-tooltip110', // Змінено на правильний клас
                            offset: [0, tooltipOffset]
                        });
                        marker.bindPopup(`
                            <b>ПС:</b> ${feature.properties.pidstancia}<br>
                            <b>Потужність по 35кв:</b> ${power} МВт<br>
                        `);
                        return marker;
                    }
                });
                // Шар для potuznist110
                var clusterGroup110 = L.markerClusterGroup({
                    showCoverageOnHover: false,
                    iconCreateFunction: function(cluster) {
                        let markers = cluster.getAllChildMarkers();
                        let totalPower = markers.reduce((sum, marker) => sum + (marker.options.power || 0), 0);
                        return L.divIcon({
                            html: `<div style="background-color: green;
                                        opacity: 0.8;
                                        font-size: 15px;
                                        border-radius: 50%; 
                                        display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        flex-direction: column;
                                        width: 50px; 
                                        height: 50px; 
                                        text-align: center; 
                                        color: white; 
                                        font-weight: bold;">
                                ${totalPower}
                            </div>`,
                            className: 'custom-cluster',
                            iconSize: [40, 40]
                        });
                    }
                });
        // Завантажуємо GeoJSON
        fetch(geojsonUrlNEK)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                var layerPotuznist110 = L.geoJSON(projektyGeojsonData, {
                    filter: function(feature) {
                        return feature.properties.potuznist110 != null && feature.properties.potuznist110 > 0;
                    },
                    pointToLayer: function(feature, latlng) {
                        let power = feature.properties.potuznist110;
                        let pidstancia = feature.properties.pidstancia.toLowerCase(); // Приводимо до нижнього регістру для порівняння
                    
                        // Перевірка на наявність слів "розділ" або "західна"
                        let fillColor = "green"; // За замовчуванням зелений
                        if (pidstancia.includes("стрий") || pidstancia.includes("калуш") || pidstancia.includes("воловець") || pidstancia.includes("тернопільська" || pidstancia.includes("хмельницька"))) {
                            fillColor = "yellow"; // Змінюємо колір на жовтий, якщо умови виконуються
                        }
                    
                        let marker = L.circleMarker(latlng, {
                            radius: Math.sqrt(power) * 1.2, // Розмір точки залежить від потужності
                            fillColor: fillColor,
                            color: "black",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    
                        let tooltipOffset = -Math.sqrt(power) * 1.2;
                    
                        marker.bindTooltip(`
                                ${power}<br>
                            `, {
                                permanent: true,
                                direction: 'top',
                                className: 'custom-tooltip110',
                                offset: [0, tooltipOffset]
                            });
                        marker.bindPopup(`
                                <b>ПС:</b> ${feature.properties.pidstancia}<br>
                                <b>Потужність по 110кв:</b> ${power} МВт<br>
                            `);
                        marker.options.power = power;
                        return marker;
                    }
                });
                clusterGroup110.addLayer(layerPotuznist110);      

        var geojsonUrlpidstobl = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/obl-pidstancii-all-zahid.geojson';
        fetch(geojsonUrlpidstobl)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Функція перевірки, чи є хоча б одне значення voltage >= 35000
                function voltageFilter(feature) {
                    if (!feature.properties.voltage) return false; // Якщо поле відсутнє
                    let voltages = feature.properties.voltage.split(";").map(v => parseInt(v.trim())); // Розділяємо та перетворюємо у числа
                    return voltages.some(v => v >= 35000); // Перевіряємо, чи є хоча б одне значення ≥ 35000
                }
                // Фільтруємо GeoJSON
                let filteredData = {
                    type: "FeatureCollection",
                    features: projektyGeojsonData.features.filter(voltageFilter)
                };
                // Створюємо шар з відфільтрованими даними
                oblpidstLayer = L.geoJSON(filteredData, {
                    pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, {
                            radius: 4,
                            fillColor: "blue",
                            color: "black",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 1
                        });
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Назва:</b> ${feature.properties.full_name || feature.properties.name || 'Unknown'}<br>
                            <b>Напруга:</b> ${feature.properties.voltage || 'Unknown'}<br>
                            <b>Потужність:</b> ${feature.properties.rating || 'Unknown'}<br>
                            <b>Оператор:</b> ${feature.properties.operator || 'Unknown'}
                        `);
                    }
                });         
                                                                    


//----------------------------------------------------------------екологія 700м аеродроми обмеження-----------------------------------------------------------------



        var opacity700 = 0.3
        var color700 = '#548be3'
        var geojsonUrlLvivbuf = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_lviv.geojson';
        fetch(geojsonUrlLvivbuf)
            .then(response => response.json())
            .then(borderGeojsonData => {
                buflvivLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlvolin = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_volin.geojson';
        fetch(geojsonUrlvolin)
            .then(response => response.json())
            .then(borderGeojsonData => {
                volinLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlzakarpatsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_zakarpatsk.geojson';
        fetch(geojsonUrlzakarpatsk)
            .then(response => response.json())
            .then(borderGeojsonData => {
                zakarpatskLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlrivne = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_rivne.geojson';
        fetch(geojsonUrlrivne)
            .then(response => response.json())
            .then(borderGeojsonData => {
                rivneLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlternopil = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_ternopil.geojson';
        fetch(geojsonUrlternopil)
            .then(response => response.json())
            .then(borderGeojsonData => {
                ternopilLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlfrankivsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_frankivsk.geojson';
        fetch(geojsonUrlfrankivsk)
            .then(response => response.json())
            .then(borderGeojsonData => {
                frankivskLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlchernivci = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_chernivci.geojson';
        fetch(geojsonUrlchernivci)
            .then(response => response.json())
            .then(borderGeojsonData => {
                chernivciLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlhmelnitsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/merged_buffers_hmelnitsk.geojson';
        fetch(geojsonUrlhmelnitsk)
            .then(response => response.json())
            .then(borderGeojsonData => {
                hmelnitskLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: color700, // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: opacity700
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlaerodromi = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/aerodromi_buffers.geojson';
        fetch(geojsonUrlaerodromi)
            .then(response => response.json())
            .then(borderGeojsonData => {
                aerodromiLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: '#cf4b44', // Колір шару
                        weight: 2, // Товщина ліній
                        fillOpacity: 0
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });
        var geojsonUrlaerodromi16 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/aerodromi_buffers_16.geojson';
        fetch(geojsonUrlaerodromi16)
            .then(response => response.json())
            .then(borderGeojsonData => {
                aerodromiLayer16 = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: '#cf4b44', // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: 0.3
                    },
                    interactive: false,
                    zIndex: -998  // Встановлюємо zIndex, щоб шар був під іншими
                });

        var geojsonUrlourairports = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/ourairports.geojson';
            fetch(geojsonUrlourairports)
                .then(response => response.json())
                .then(projektyGeojsonData => {
                    ourairports = L.geoJSON(projektyGeojsonData, {
                        pointToLayer: function(feature, latlng) {
                            var icon;
                            // Вибір іконки на основі типу
                            if (feature.properties.type === 'large_airport') {
                                icon = L.divIcon({
                                    html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EA3323"><path d="m397-115-99-184-184-99 71-70 145 25 102-102-317-135 84-86 385 68 124-124q23-23 57-23t57 23q23 23 23 56.5T822-709L697-584l68 384-85 85-136-317-102 102 26 144-71 71Z"/></svg>`,
                                    className: 'no-background-icon'
                                });
                            } else if (feature.properties.type === 'medium_airport') {
                                icon = L.divIcon({
                                    html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#F19E39"><path d="m397-115-99-184-184-99 71-70 145 25 102-102-317-135 84-86 385 68 124-124q23-23 57-23t57 23q23 23 23 56.5T822-709L697-584l68 384-85 85-136-317-102 102 26 144-71 71Z"/></svg>`,
                                    className: 'no-background-icon'
                                });
                            } else if (feature.properties.type === 'small_airport') {
                                icon = L.divIcon({
                                    html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#8B7DBE"><path d="m397-115-99-184-184-99 71-70 145 25 102-102-317-135 84-86 385 68 124-124q23-23 57-23t57 23q23 23 23 56.5T822-709L697-584l68 384-85 85-136-317-102 102 26 144-71 71Z"/></svg>`,
                                    className: 'no-background-icon'
                                });
                            } else if (feature.properties.type === 'closed') {
                                icon = L.divIcon({
                                    html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#8B7DBE"><path d="m880-280-141-57-339-337v-126q0-33 23.5-56.5T480-880q33 0 56.5 23.5T560-800v176l320 224v120ZM480-140 280-80v-100l120-84v-144L80-280v-120l216-152L56-792l56-56 736 736-56 56-232-232v24l120 84v100l-200-60Z"/></svg>`,
                                    className: 'no-background-icon'
                                });
                            } else if (feature.properties.type === 'heliport') {
                                icon = L.divIcon({
                                    html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#8B7DBE"><path d="M280-280v-400h80v160h240v-160h80v400h-80v-160H360v160h-80Z"/></svg>`,
                                    className: 'no-background-icon'
                                });
                            }
                            // Повертаємо точку з потрібною іконкою
                            return L.marker(latlng, { icon: icon });
                        },
                        onEachFeature: function(feature, layer) {
                            layer.bindPopup(`
                                <b>Назва:</b> ${feature.properties.name || 'Unknown'}<br>
                                <b>Тип:</b> ${feature.properties.type || 'Unknown'}<br>
                                ${feature.properties.wikipedia ? `<a href='${feature.properties.wikipedia}' target="_blank">Link</a>` : ''}
                            `);
                        }
                    });
                });

                var geojsonUrlaeroruh = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/aeroruh.geojson';
                var createPolygonLayerAeroruh = (geojsonData, category) => {
                    // Фільтруємо дані за категорією "Комент"
                    var filteredFeatures = geojsonData.features.filter(feature => 
                        feature.properties["Комент"] && feature.properties["Комент"].includes(category)
                    );

                    var filteredGeojson = {
                        type: "FeatureCollection",
                        features: filteredFeatures
                    };

                    // Створення шару з лініями, що виглядають як штрихування
                    return L.geoJSON(filteredGeojson, {
                        style: function(feature) {
                            return { 
                                color: category === "Диспечерські зони" ? '#736734' : 
                                    category === "Тренувальні зони" ? '#31bdb8' : 
                                    category === "Заборонені, небезпечні зони" ? '#bf73bd' : 
                                    category === "Військові диспечерські зони" ? '#09052b' : 
                                    category === "Термінальні диспечерські зони" ? '#2e130d' : 'gray', 
                                weight: 2,  // Товщина контуру
                                fillOpacity: 0.3,  // Прозорість заповнення
                                dashArray: '5,5'  // Штриховані лінії
                            };
                        },
                        onEachFeature: function(feature, layer) {
                            layer.bindPopup(`
                                <b>Коментар:</b> ${feature.properties["Комент"] || 'Unknown'}
                            `);
                        }
                    });
                };

// Завантаження GeoJSON і створення шарів для різних категорій
fetch(geojsonUrlaeroruh)
    .then(response => response.json())
    .then(geojsonData => {
        layerDispatcherZones = createPolygonLayerAeroruh(geojsonData, "Диспечерські зони");
        layerTrainingZones = createPolygonLayerAeroruh(geojsonData, "Тренувальні зони");
        layerRestrictedZones = createPolygonLayerAeroruh(geojsonData, "Заборонені, небезпечні зони");
        layerMilitaryZones = createPolygonLayerAeroruh(geojsonData, "Військові диспечерські зони");
        layerTerminalZones = createPolygonLayerAeroruh(geojsonData, "Термінальні диспечерські зони");
     

                                                                                         //map.getPane('borderPane').style.zIndex = 400;
        var waterPolyLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/water_poly_ramsar/{z}/{x}/{y}.png');
        var dzkPzfLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__pzf/{z}/{x}/{y}.png');
        var cadastrLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/parcels/{z}/{x}/{y}.png');
        var oblastLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_oblast/{z}/{x}/{y}.png');
        var raionLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_rayon/{z}/{x}/{y}.png');
        var otgLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_terhromad__line/{z}/{x}/{y}.png');

        var geojsonUrlemerald = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/amerald_zahid.geojson';
        fetch(geojsonUrlemerald)
            .then(response => response.json())
            .then(borderGeojsonData => {
                emeraldLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: '#3b8f51', // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: 0.3
                    },
                    interactive: false,
                    zIndex: -999  // Встановлюємо zIndex, щоб шар був під іншими
                });



//----------------------------------------------------------------tifs-----------------------------------------------------------------


        var geotiffUrlw = "https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/UKR_wind-speed_100m-.tif";  
        var geotiffUrlNew = "https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/virobitka.tif";  

        var layerWind, layerSolar;
        var windPopupActive = false, solarPopupActive = false;
        var windLegend = null, solarLegend = null;

        // ========================= ЛЕГЕНДА ВІТРУ =========================
        var WindLegendControl = L.Control.extend({
          options: { position: 'bottomleft' },
          onAdd: function () {
            var div = L.DomUtil.create('div', 'info legend wind-legend');
            div.innerHTML = `
              <b>Швидкість вітру</b><br>
              <i style="background: #f4fc03"></i> 7 - 7.3<br>
              <i style="background: #fcce03"></i> 7.31 - 7.6<br>
              <i style="background: #fc9003"></i> 7.61 - 7.9<br>
              <i style="background: #fc4e03"></i> 7.91 - 8.2<br>
              <i style="background: #d60606"></i> 8.21 - 8.5<br>
              <i style="background: #6e0000"></i> 8.51+<br>
            `;
            div.style.background = 'white';
            div.style.padding = '10px';
            div.style.border = '1px solid #333';
            div.style.borderRadius = '5px';
            //div.style.zIndex = "100000";
            setTimeout(() => div.classList.add('show'), 50);
            return div;
          }
        });
        // ========================= ЛЕГЕНДА виробітки =========================
        var SolarLegendControl = L.Control.extend({
          options: { position: 'bottomleft' },
          onAdd: function () {
            var div = L.DomUtil.create('div', 'info legend wind-legend');
            div.innerHTML = `
              <b>Виробітка</b><br>
              <i style="background: #f4fc03"></i> 3000 - 3200<br>
              <i style="background: #fcce03"></i> 3200 - 3400<br>
              <i style="background: #fc9003"></i> 3400 - 3600<br>
              <i style="background: #fc4e03"></i> 3600 - 3800<br>
              <i style="background: #d60606"></i> 3800+
            `;
            div.style.background = 'white';
            div.style.padding = '10px';
            div.style.border = '1px solid #333';
            div.style.borderRadius = '5px';
            //div.style.zIndex = "100000";
            setTimeout(() => div.classList.add('show'), 50);
            return div;
          }
        });

        // ========================= ДОДАЄМО ГЕОТІФФ =========================
        function addGeoTiffLayer(url, colorScale, callback) {
          fetch(url)
            .then(res => res.arrayBuffer())
            .then(arrayBuffer => {
              parseGeoraster(arrayBuffer).then(georaster => {
                var layer = new GeoRasterLayer({
                  georaster: georaster,
                  opacity: 0.5,
                  pixelValuesToColorFn: colorScale,
                  zIndex: 20,
                  resolution: 128
                });
            
                callback(layer, georaster);
              });
            });
        }

        // ========================= ПОПАПИ =========================
        function createPopupHandler(georaster, isActive) {
          return function (event) {
            if (!isActive()) return;

            var lat = event.latlng.lat;
            var lng = event.latlng.lng;
            var value = geoblaze.identify(georaster, [lng, lat]);

            if (value !== undefined) {
              L.popup()
                .setLatLng([lat, lng])
                .setContent(Number(value).toFixed(5))
                .openOn(map);
            }
          };
        }

        // ========================= ЛЕГЕНДА =========================
        function toggleLegend(legendControl, legendInstance) {
          if (legendInstance) {
            map.removeControl(legendInstance);
            return null;
          } else {
            let newLegend = new legendControl();
            newLegend.addTo(map);
            return newLegend;
          }
        }

        // ========================= КНОПКИ =========================
        function createLayerControlButton(icon, toggleLayerCallback) {
          var ControlButton = L.Control.extend({
            onAdd: function () {
              var button = L.DomUtil.create('button');
              button.innerHTML = icon;
              button.style.backgroundColor = '#ffffff';
              button.style.border = '1px solid #333';
              button.style.padding = '5px';
              button.style.fontSize = '25px';
              button.style.cursor = 'pointer';
              button.style.borderRadius = '5px';
            
              L.DomEvent.on(button, 'click', function (e) {
                L.DomEvent.stopPropagation(e);
                toggleLayerCallback();
              });
          
              return button;
            },
            position: 'topleft'
          });
          map.addControl(new ControlButton());
        }

        // ========================= ДОДАЄМО ШАР ВІТРУ =========================
        addGeoTiffLayer(
          geotiffUrlw,
            v => (isNaN(v) || v < 7) ? null : 
                 v <= 7.3 ? '#f4fc03' : 
                 v <= 7.6 ? '#fcce03' : 
                 v <= 7.9 ? '#fc9003' : 
                 v <= 8.2 ? '#fc4e03' : 
                 v <= 8.5 ? '#d60606' : '#6e0000',
          function (layer, georaster) {
            layerWind = layer;
            map.on("click", createPopupHandler(georaster, () => windPopupActive));
        
            createLayerControlButton("🌪️", function () {
              windPopupActive = !windPopupActive;
              if (map.hasLayer(layerWind)) {
                map.removeLayer(layerWind);
                windLegend = toggleLegend(WindLegendControl, windLegend);
              } else {
                map.addLayer(layerWind);
                windLegend = toggleLegend(WindLegendControl, windLegend);
              }
            });
          }
        );
      
        // ========================= ДОДАЄМО ШАР виробітки =========================
        addGeoTiffLayer(
          geotiffUrlNew,
          v => v < 2999 ? null : 
               v <= 3200 ? '#f4fc03' : 
               v <= 3400 ? '#fcce03' : 
               v <= 3600 ? '#fc9003' : 
               v <= 3800 ? '#fc4e03' : '#fc4e03',
          function (layer, georaster) {
            layerSolar = layer;
            map.on("click", createPopupHandler(georaster, () => solarPopupActive));
        
            createLayerControlButton("⚡", function () {
              solarPopupActive = !solarPopupActive;
              if (map.hasLayer(layerSolar)) {
                map.removeLayer(layerSolar);
                solarLegend = toggleLegend(SolarLegendControl, solarLegend);
              } else {
                map.addLayer(layerSolar);
                solarLegend = toggleLegend(SolarLegendControl, solarLegend);
              }
            });
          }
        );
      
//---------------------------------------------------------------------------------------------------------------------------------




        var geojsonUrsmall_14_01 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/14-01-zahid-small.geojson';
        fetch(geojsonUrsmall_14_01)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                small_14_01 = L.geoJSON(projektyGeojsonData, {
                    style: function(feature) {
                        return {
                            fillColor: "purple", // Колір заповнення полігону
                            color: "black", // Колір обведення
                            weight: 3, // Товщина обведення
                            opacity: 1, // Прозорість обведення
                            fillOpacity: 0.6 // Прозорість заповнення
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Номер:</b> ${feature.properties["landuse.cadnum"] || 'Unknown'}<br>
                            <b>Площа:</b> ${feature.properties.area || 'Unknown'}<br>
                            <b>Використання:</b> ${feature.properties.use || 'Unknown'}<br>
                            <b>Категорія:</b> ${feature.properties.category || 'Unknown'}<br>
                            <b>Власність:</b> ${feature.properties.ownership || 'ownership'}<br>
                        `);
                    }
                });

        var geojsonKonkurentyzahidvitr = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/diluankikonkurenti.geojson';
        fetch(geojsonKonkurentyzahidvitr)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                vitr_zahid = L.geoJSON(projektyGeojsonData, {
                    style: function(feature) {
                        return {
                            fillColor: "blue", // Колір заповнення полігону
                            color: "black", // Колір обведення
                            weight: 3, // Товщина обведення
                            opacity: 1, // Прозорість обведення
                            fillOpacity: 0.6 // Прозорість заповнення
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Номер:</b> ${feature.properties.cadnum || feature.properties["landuse.cadnum"] || 'Unknown'}<br>
                            <b>LN:</b> ${feature.properties.LN || 'Unknown'}<br>
                        `);
                    }
                });

        var geojsonUrlkonkurenty16 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/konkurenty_buffers_16.geojson';
        fetch(geojsonUrlkonkurenty16)
            .then(response => response.json())
            .then(borderGeojsonData => {
                console.log(geojsonUrlkonkurenty16)
                konkurentyLayer16 = L.geoJSON(borderGeojsonData, {
                    style: function(feature) {
                    return {
                        color: 'purple', // Колір шару
                        weight: 1, // Товщина ліній
                        fillOpacity: 0.5
                    };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Назва:</b> ${feature.properties.name || 'Unknown'}<br>
                            <b>Потужність:</b> ${feature.properties.height || 'Unknown'} МВт<br>
                        `);
                    }                   
                });
            

        var geojsonUrlAnimal = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/animalss.geojson';
        fetch(geojsonUrlAnimal)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або ряд = 'Chiroptera'
                let filteredData = {
                    type: "FeatureCollection",
                    features: projektyGeojsonData.features.filter(feature => 
                        feature.properties.class === "Aves" || feature.properties.family === "Vespertilionidae" || feature.properties.family === "Rhinolophidae"
                    )
                };
                // Створюємо шар з відфільтрованими даними
                animalLayer = L.geoJSON(filteredData, {
                    pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, {
                            radius: 4, 
                            fillColor: "red",
                            color: "black",
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 1
                        });
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>Назва:</b> ${feature.properties.scientificName || 'Unknown'}<br>
                            <b>Клас:</b> ${feature.properties.class || 'Unknown'}<br>
                            <b>Ряд:</b> ${feature.properties.order || 'Unknown'}<br>
                            <b>Дата:</b> ${feature.properties.eventDate || 'Unknown'}
                        `);
                    }
                })

        


// --------------------------------- points to mark наші локації ------------------------------------

        var geojsonUrlpointskovel17 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Kovel/Ковель 17 ВЕУ-329957 MWh-3290.geojson';
        fetch(geojsonUrlpointskovel17)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_kovel17 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff00c8"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
                var geojsonUrlpointskovel25 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Kovel/Ковель 25 ВЕУ-473797 MWh-3212.geojson';
        fetch(geojsonUrlpointskovel25)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_kovel25 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#020dd6"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });

//------------------------------------------------radiviliv----------------------------------------------

        var geojsonUrlpointsradiviliv17 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Radiviliv/Радивилів 17 ВЕУ-323451 MWh- 3225.geojson';
        fetch(geojsonUrlpointsradiviliv17)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_radiviliv17 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff00c8"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
        var geojsonUrlpointsradiviliv25 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Radiviliv/Радивилів 25 ВЕУ-467013 MWh- 3166.geojson';
        fetch(geojsonUrlpointsradiviliv25)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_radiviliv25 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#020dd6"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
        //------------------------------------------------lutsk----------------------------------------------

        var geojsonUrlpointslutsk17 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Lutsk/Луцьк 17 ВЕУ-341399 MWh-3404.geojson';
        fetch(geojsonUrlpointslutsk17)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_lutsk17 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff00c8"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
        var geojsonUrlpointslutsk25 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Lutsk/Луцьк 25 ВЕУ-493208 MWh-3344.geojson';
        fetch(geojsonUrlpointslutsk25)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_lutsk25 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#020dd6"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });


                //------------------------------------------------ternopil----------------------------------------------

        var geojsonUrlpointsternopil17 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Ternopil/Тернопіль-17 ВЕУ-339436 MWh.geojson';
        fetch(geojsonUrlpointsternopil17)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_ternopil17 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff00c8"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
        var geojsonUrlpointsternopil25 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Ternopil/Тернопіль-25 ВЕУ-488633 MWh.geojson';
        fetch(geojsonUrlpointsternopil25)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_ternopil25 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#020dd6"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
         //------------------------------------------------grabiv----------------------------------------------

         var geojsonUrlpointsgrabiv17 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Grabiv/Грабів 17 ВЕУ-332909 MWh.geojson';
        fetch(geojsonUrlpointsgrabiv17)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_grabiv17 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ff00c8"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });
        var geojsonUrlpointsgrabiv25 = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Grabiv/Грабів 25 ВЕУ-481663 MWh.geojson';
        fetch(geojsonUrlpointsgrabiv25)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                // Фільтруємо дані: тільки де клас = 'Aves' або родина = 'Vespertilionidae' чи 'Rhinolophidae'
                // Створюємо шар з відфільтрованими даними
                vitryaki_grabiv25 = L.geoJSON(projektyGeojsonData, {
                    pointToLayer: function(feature, latlng) {
                        // Створюємо кастомну іконку з SVG
                        var icon = L.divIcon({
                            html: `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#020dd6"><path d="M480-80q-106 0-173-33.5T240-200q0-24 14.5-44.5T295-280l63 59q-9 4-19.5 9T322-200q13 16 60 28t98 12q51 0 98.5-12t60.5-28q-7-8-18-13t-21-9l62-60q28 16 43 36.5t15 45.5q0 53-67 86.5T480-80Zm1-220q99-73 149-146.5T680-594q0-102-65-154t-135-52q-70 0-135 52t-65 154q0 67 49 139.5T481-300Zm-1 100Q339-304 269.5-402T200-594q0-71 25.5-124.5T291-808q40-36 90-54t99-18q49 0 99 18t90 54q40 36 65.5 89.5T760-594q0 94-69.5 192T480-200Zm0-320q33 0 56.5-23.5T560-600q0-33-23.5-56.5T480-680q-33 0-56.5 23.5T400-600q0 33 23.5 56.5T480-520Zm0-80Z"/></svg>`,
                            className: 'no-background-icon', // Уникаємо білого фону
                            iconSize: [24, 24], // Розмір іконки
                            iconAnchor: [12, 12] // Центруємо іконку по координатам
                        });
                        return L.marker(latlng, { icon: icon });
                    }
                });





            
        var geojsonUrlbuffer40kmpidst = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/40km-radius.geojson';
        fetch(geojsonUrlbuffer40kmpidst)
            .then(response => response.json())
            .then(borderGeojsonData => {
                buffer40pidstLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: '#2d0396', // Колір шару
                        weight: 2, // Товщина ліній
                        fillOpacity: 0,
                        zIndex: 100, // Задаємо z-index
                        dashArray: '5, 10'
                    },
                    interactive: false
                });
        var geojsonUrlbuffer25kmpidst = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/25km-radius.geojson';
        fetch(geojsonUrlbuffer25kmpidst)
            .then(response => response.json())
            .then(borderGeojsonData => {
                buffer25pidstLayer = L.geoJSON(borderGeojsonData, {
                    style: {
                        color: 'orange', // Колір шару
                        weight: 2, // Товщина ліній
                        fillOpacity: 0,
                        zIndex: 101, // Задаємо z-index
                        dashArray: '5, 10'
                    },
                    interactive: false
                });




//----------------------------------------------------------------shari контроль шарів-----------------------------------------------------------------
                // Структура дерева шарів
        var baseTree = {
            label: "<b>Базові карти</b>",
            children: [
                { label: "OpenStreetMap", layer: osmLayer, radioGroup: "basemap" },
                { label: "White Map", layer: WhiteLayer, radioGroup: "basemap" },
                { label: "Google Map", layer: googleLayer, radioGroup: "basemap" },
                { label: "Topo Map", layer: topoLayer, radioGroup: "basemap" },
            ]
        };
        // Дерево шарів
        var overlaysTree = {
            label: "<b>Шари</b>",
            selectAllCheckbox: true,  // Додає чекбокс для вибору всіх шарів
            children: [
                { 
                    label: "<b>Електромережі</b>", 
                    children: [
                        { label: "НЕК підстанції", layer: NEKLayer },
                        { label: "Підключення", layer: geoJsonClusterGroup },
                        { label: "Потужність по 35кВ", layer: layerPotuznist35 },
                        { label: "Потужність по 110кВ", layer: clusterGroup110 },
                        { label: "Електростанції", layer: PUALayer },
                        { label: "Обл підстанції", layer: oblpidstLayer },
                        { label: "Лінії 220+", layer: reconsLayer },
                        { label: "Лінії 110", layer: Layer110 }
                    ]
                },
                { 
                    label: "<b>Проекти</b>", 
                    collapsed: true,
                    children: [
                        { label: "Конкуренти", layer: konkurentyLayer16 },
                        { label: "Конкуренти ділянки", layer: vitr_zahid },
                        { label: "14.01 маленькі", layer: small_14_01 },
                       // { label: "50км для проектів", layer: buffer50pidstLayer }buffer40pidstLayer
                    ]
                },
                { 
                    label: "<b>Оцінка проектів</b>", 
                    collapsed: true,
                    children: [
                    {
                            label: "<b>Ковель</b>", 
                            collapsed: true,
                            children: [
                            { label: "17 ВЕС 329957 MWh", layer: vitryaki_kovel17 },
                            { label: "25 ВЕС 473797 MWh", layer: vitryaki_kovel25 },
                            ]
                        },
                        {
                            label: "<b>Луцьк</b>", 
                            collapsed: true,
                            children: [
                            { label: "17 ВЕС 341399 MWh", layer: vitryaki_lutsk17 },
                            { label: "25 ВЕС 493208 MWh", layer: vitryaki_lutsk25 },
                            ]
                        },
                        {
                            label: "<b>Радивилів</b>", 
                            collapsed: true,
                            children: [
                            { label: "17 ВЕС 323451 MWh", layer: vitryaki_radiviliv17 },
                            { label: "25 ВЕС 467013 MWh", layer: vitryaki_radiviliv25 },
                            ]
                        },
                        {
                            label: "<b>Тернопіль</b>", 
                            collapsed: true,
                            children: [
                            { label: "17 ВЕС 339436 MWh", layer: vitryaki_ternopil17 },
                            { label: "25 ВЕС 488633 MWh", layer: vitryaki_ternopil25 },
                            ]
                        },
                        {
                            label: "<b>Грабів</b>", 
                            collapsed: true,
                            children: [
                            { label: "17 ВЕС 332909 MWh", layer: vitryaki_grabiv17 },
                            { label: "25 ВЕС 481663 MWh", layer: vitryaki_grabiv25 },
                            ]
                        },
                        { label: "25км для проектів", layer: buffer25pidstLayer },
                        { label: "40км для проектів", layer: buffer40pidstLayer }
                    ]
                },
                { 
                    label: "<b>Обмеження</b>",
                    collapsed: true, 
                    children: [
                        {
                            label: "<b>Аерорух</b>", 
                            collapsed: true,
                            children: [
                                { label: "Аеродроми", layer: ourairports },
                                { label: "Диспечерські зони", layer: layerDispatcherZones },
                                { label: "Тренувальні зони", layer: layerTrainingZones },
                                { label: "Заборонені, небезпечні зони", layer: layerRestrictedZones },
                                { label: "Військові диспечерські зони", layer: layerMilitaryZones },
                                { label: "Термінальні диспечерські зони", layer: layerTerminalZones },
                                { label: "Приаеродромна 50км", layer: aerodromiLayer },
                                { label: "Приаеродромна 16км", layer: aerodromiLayer16 },
                            ]
                        },
                        { label: "Львів", layer: buflvivLayer },
                        { label: "Волинь", layer: volinLayer },
                        { label: "Закарпаття", layer: zakarpatskLayer },
                        { label: "Рівне", layer: rivneLayer },
                        { label: "Тернопіль", layer: ternopilLayer },
                        { label: "Франківськ", layer: frankivskLayer },
                        { label: "Чернівці", layer: chernivciLayer },
                        { label: "Хмельницьк", layer: hmelnitskLayer },
                    ]
                },
                { 
                    label: "<b>Природоохоронні дані</b>", 
                    collapsed: true,  // ❗ Згорнута група
                    children: [
                        { label: "<span>Птахи, кажани (ЧК)</span>", layer: animalLayer },
                        { label: "<span>Рамсарська конвенція</span>", layer: waterPolyLayer },
                        { label: "<span>Природно-заповідний фонд</span>", layer: dzkPzfLayer },
                        { label: "<span>Смарагдова мережа</span>", layer: emeraldLayer }
                    ]
                },
                { 
                    label: "<b>Адміністративний поділ</b>", 
                    collapsed: true,
                    children: [
                    { label: "Межі України", layer: borderLayer },
                    { label: "Межі областей", layer: oblastLayer },
                    { label: "Межі районів", layer: raionLayer },
                    { label: "Межі ОТГ", layer: otgLayer },
                    { label: "Кадастр підкладка", layer: cadastrLayer },
                    ]
                },
                
            ]
        };

        // Додаємо контроль шарів
        var layerControl = L.control.layers.tree(baseTree, overlaysTree, {
            namedToggle: false,  
            selectorBack: false, 
            closedSymbol: "▶",  
            openedSymbol: "▼",  
            collapsed: true
        }).addTo(map);

        function addLayersAfterAnimation() {
            setTimeout(() => {
                // Додаємо шари після завершення анімації
                reconsLayer.addTo(map);
                clusterGroup110.addTo(map);
                // geoJsonClusterGroup.addTo(map);  // якщо потрібно
                borderLayer.addTo(map);
                legend.addTo(map);
                
            }, 1000); // затримка 4 секунди (тривалість анімації)
        }
                        
        addLayersAfterAnimation();





            // Створюємо контейнер для меню
        const menu = document.createElement('div');
        menu.id = 'menu';
        menu.style.position = 'absolute';
        menu.style.top = '10px';
        menu.style.left = '10px';
        menu.style.background = 'white';
        menu.style.padding = '10px';
        menu.style.border = '1px solid black';
        menu.style.display = 'none';
        menu.style.zIndex = 10000000;
        menu.innerHTML = `
            <div style='padding-bottom: 5px; text-align: center; font-size: 20px;'>Cзз зміна кольору</div>
            <label>Колір: <input type="color" id="colorPicker" value="#548be3"></label><br>
            <label>Прозорість: <input type="range" id="opacityPicker" min="0" max="1" step="0.1" value="0.3"></label><br>
            <button id="applyBtn" style='width: 100%; margin-top: 5px;'>OK</button>
        `;
        document.body.appendChild(menu);
        // Змінні для збереження обраних значень
        let selectedColor = '#3388ff';
        let selectedOpacity = 0.5;
        document.getElementById('colorPicker').addEventListener('input', (e) => {
            selectedColor = e.target.value;
        });
        document.getElementById('opacityPicker').addEventListener('input', (e) => {
            selectedOpacity = e.target.value;
        });
        // Кнопка відкриття меню
        const menuBtn = L.control({ position: 'topleft' });
        menuBtn.onAdd = function () {
            const btn = L.DomUtil.create('button', 'menu-btn');
            btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z"/></svg>';
            btn.style.position = 'absolute';
            btn.style.top = '';
            btn.style.left = '45px';
            btn.style.background = 'white';
            btn.style.cursor = 'pointer';
            btn.style.borderRadius= '5px';
            btn.onclick = () => {
                menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            };
            return btn;
        };
        menuBtn.addTo(map);
        // Кнопка застосування змін
        document.getElementById('applyBtn').addEventListener('click', () => {
            buflvivLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            volinLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            zakarpatskLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            rivneLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            frankivskLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            ternopilLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            chernivciLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            hmelnitskLayer.setStyle({color: selectedColor, fillColor: selectedColor, fillOpacity: selectedOpacity });
            menu.style.display = 'none';
        });

        


})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
})
.catch(error => console.error('Помилка завантаження GeoJSON (підключення):', error));
                                   
    </script>

    <!-- Завантажуємо бібліотеки через IIFE для кадастру-->
    <script>
        (async function() {
            window.Pbf = (await import("https://cdn.skypack.dev/pbf")).default;
            window.VectorTile = (await import("https://cdn.skypack.dev/@mapbox/vector-tile")).VectorTile;
        })();
    </script>
    
    <script defer src="./script-cadastr.js"></script>
</body>
</html>

