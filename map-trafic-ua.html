<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet TimeDimension Demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Open+Sans&display=swap" rel="stylesheet">
   
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            
            height: 100%;
            width: 100%;
            font-family: 'Open Sans', sans-serif !important;
        }
        .export-import-tooltip{
            background-color: rgba(255, 255, 128, .5);
            
        }
        .imp-exp-block{
            display: flex;
            align-items: center;
            align-content: center;
            flex-direction: column;
            background-color: white; ;
            margin-top: 30%;
        }
        .leaflet-control{
            
            background: white;
            border: none !important;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px !important;
        }
        .leaflet-control-layers-list{
            margin: 5px;
        }
        .leaflet-control-layers-list .leaflet-layerstree-header:hover{
            /*text-decoration: underline;*/
            background-color: rgb(240, 240, 240);
            cursor: pointer;
        }
        /*-------------------legend---------------*/

        .leaflet-legend {
            background: white;
            padding: 5px;
            margin: 10px;
            max-width: 210px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;        
            align-content: center;
            justify-content: center;
            line-height: 1.2;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            /* –í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
            gap: 8px; /* –í—ñ–¥—Å—Ç—É–ø –º—ñ–∂ —ñ–∫–æ–Ω–∫–æ—é —Ç–∞ —Ç–µ–∫—Å—Ç–æ–º */

        }

        .legend-icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }


        .leaflet-legend .l750{
            background: #ba1806;
        }
        .leaflet-legend .l400{
            background: #f505fa;
        }
        .leaflet-legend .l330{
            background: #0572a1;
        }
        .leaflet-legend .l220{
            background: green;
        }
        .leaflet-legend .l110{
            background: #b89023;
        }
        
        .leaflet-legend div{
            display: flex;
            flex-direction: row;
            margin: 5px;
        }

        .leaflet-legend i {
            min-width: 18px;
            min-height: 18px;
            max-width: 18px;
            max-height: 18px;
            float: left;
            margin-right: 8px;
            
            opacity: 0.7;
        }
        .leaflet-legend .ves {
            background: green;
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .p35 {
            background: rgb(1, 33, 172);
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .z700 {
            background: rgba(15, 207, 207, 0.479);
            border-radius: 50%;
            border: 2px solid rgb(0, 247, 255);
        }
        .leaflet-legend .ses {
            background: yellow;
            border-radius: 50%;
            border: 2px solid black;
        }
        .leaflet-legend .uze{
            background: #a92dad;
            border-radius: 50%;
            border: 2px solid purple;
        }
        .leaflet-legend .all{
            background: gray;
            border-radius: 50%;
            border: 2px solid black;
        }
        .custom-tooltip {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid black;
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .transperent{
            background-color: #0572a1;
        }
        .leaflet-tooltip.custom-tooltip1{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip1:before {
            display: none !important; /* –í–∏–º–∏–∫–∞—î —Å—Ç—Ä—ñ–ª–æ—á–∫—É */
        }
        .leaflet-tooltip.custom-tooltip110{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip110:before {
            display: none !important; /* –í–∏–º–∏–∫–∞—î —Å—Ç—Ä—ñ–ª–æ—á–∫—É */
        }
        .info-control {
            padding: 10px 13px;
            border-radius: 2px;
        }
        .info-control:hover {
            cursor: pointer;
        }
        .legend i {
            display: inline-block;
            width: 20px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid black;
        }

        .layer-measureboundary {
    stroke: red !important; /* –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä */
    stroke-width: 4px !important; /* –¢–æ–≤—â–∏–Ω–∞ */
    opacity: 0.8 !important; /* –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å */
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –∫—ñ–Ω—Ü–µ–≤–æ—ó –ª—ñ–Ω—ñ—ó (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è) */
.layer-measure-resultline {
    stroke: rgb(255, 0, 0) !important; /* –°–∏–Ω—ñ–π –∫–æ–ª—ñ—Ä */
    stroke-width: 4px !important; /* –¢–æ–≤—â–∏–Ω–∞ */
    opacity: 1 !important;
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –ø–ª–æ—â—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è */
.layer-measure-resultarea {
    fill: rgba(192, 70, 77, 0.3) !important; /* –ü—Ä–æ–∑–æ—Ä–∏–π –∑–µ–ª–µ–Ω–∏–π */
    stroke: rgb(255, 0, 0) !important; /* –û–±–≤–µ–¥–µ–Ω–Ω—è –∑–µ–ª–µ–Ω–µ */
    stroke-width: 4px !important;
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è —Ç–æ—á–æ–∫ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è */
.layer-measurevertex {
    fill: rgb(255, 0, 0) !important;
    stroke: black !important;
    stroke-width: 4px;
    r: 6px; /* –†–∞–¥—ñ—É—Å —Ç–æ—á–∫–∏ */
}




.leaflet-pm-text {
    font-size: 20px;  /* –ó–∞–¥–∞–π—Ç–µ –±–∞–∂–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É */
    font-weight: bold; /* –ú–æ–∂–Ω–∞ —Ç–∞–∫–æ–∂ –∑–º—ñ–Ω–∏—Ç–∏ —Ç–æ–≤—â–∏–Ω—É —à—Ä–∏—Ñ—Ç—É */
    color: red; /* –ö–æ–ª—ñ—Ä —à—Ä–∏—Ñ—Ç—É */
}
        
    </style>
</head>
<body>
    
    <div id="map"></div>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iso8601-js-period@0.2.1/iso8601.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://unpkg.com/esri-leaflet/dist/esri-leaflet.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://jjimenezshaw.github.io/Leaflet.Control.Layers.Tree/L.Control.Layers.Tree.js"></script>

    
    
    <!-- JavaScript –¥–ª—è MarkerCluster -->
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

    <!--line-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css" />
    <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>
    <!--tiffff-->
    <script src="https://cdn.jsdelivr.net/npm/georaster@1.6.0/dist/georaster.browser.bundle.min.js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rainbowvis.js@1.1.1/rainbowvis.js"></script>
    <script src="https://unpkg.com/geoblaze"></script>
    <!--derevo-->
    <link rel="stylesheet" href="L.Control.Layers.Tree.css">
    <script src="L.Control.Layers.Tree.js"></script>

    <!-- draw tool-------->
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>


    <script>
        // URLs –¥–ª—è GeoJSON —Ñ–∞–π–ª—ñ–≤
       

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏
        var map = L.map('map', {
            zoom: 7,
            center: [49.763967421708514, 27.982313845924605],

        });

        var legend = L.control({ position: 'bottomleft' });

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'leaflet-legend');
            
                            div.innerHTML = `
                                <div><i class="l750"></i>–ê–ï–°</div>
                                <div><i class="l110"></i>–¢–ï–°</div>
                                <div><i class="l330"></i>–ì–ï–°</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#8B1A10" d="M200-440v-80h560v80H200Z"/></svg>750 –∫–í</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#EA33F7" d="M200-440v-80h560v80H200Z"/></svg> 400 –∫–í</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#2854C5" d="M200-440v-80h560v80H200Z"/></svg> 330 –∫–í</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#48752C" d="M200-440v-80h560v80H200Z"/></svg> 220 –∫–í</div>
                                <div class="legend-item"><svg class="legend-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path fill="#EAC452" d="M200-440v-80h560v80H200Z"/></svg> 110 –∫–í</div>
                                <div><i class="z700"></i> –°–ó–ó</div>
                                <div><i class="uze"></i> –í–ï–° –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</div>
                                <div><i class="ves"></i> –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å 110 –∫–í</div>
                                <div><i class="p35"></i> –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å 35 –∫–í</div>
                                <div><i class="ses"></i> –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —ñ–∑ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è</div>
                            `;                
            return div;
        };

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–ª–∏—Ç–æ–∫ –∫–∞—Ä—Ç–∏ (OpenStreetMap)
        var osmLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png');

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–ª–∏—Ç–æ–∫ Google Maps
        var googleLayer = L.tileLayer('http://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {
            attribution: 'Google Maps'
        });

    // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è OpenStreetMap
        osmLayer.addTo(map);


       L.Control.Info = L.Control.extend({
            onAdd: function(map) {
                var container = L.DomUtil.create("div", "info-control");
                container.innerHTML = "‚Ñπ";
                container.title = "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó";
                
                container.onclick = function() {
                    alert("üìå –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –∫–∞—Ä—Ç—É.\nüìå –ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ç–∞–π–ª –∑ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏.\nüìå –î–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–æ–ª–µ—Å–∏–∫–æ –º–∏—à—ñ.");
                };
        
                return container;
            }
        });

        // –î–æ–¥–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –Ω–∞ –∫–∞—Ä—Ç—É
        var infoControl = new L.Control.Info({ position: "topleft" });
        map.addControl(infoControl);

        var measureControl = new L.Control.Measure({
            position: "topleft",
            primaryLengthUnit: "meters",
            secondaryLengthUnit: "kilometers", // –û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
            primaryAreaUnit: "hectares",
            secondaryAreaUnit: "sqmeters",
            showMeasurements: true, // –ü–æ–∫–∞–∑—É—î –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ–π
            captureZIndex: 10000,
            measureControlTitle: "–í–∏–º—ñ—Ä—è—Ç–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å",
            activeColor: '#ff0000',  // –ö–æ–ª—ñ—Ä –ª—ñ–Ω—ñ—ó –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
            completedColor: '#0000ff'
            
        });

        map.addControl(measureControl);

        
        // –î–æ–¥–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –Ω–∞ –∫–∞—Ä—Ç—É
        map.pm.addControls({
            position: 'bottomright', // –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ
            drawCircle: true,
            drawRectangle: false,
            drawPolygon: false, // –í–∏–º–∫–Ω—É—Ç–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è –∫—ñ–ª
            drawMarker: false, // –í–∏–º–∫–Ω—É—Ç–∏ —Ç–æ—á–∫–∏
            drawCircleMarker: false, // –í–∏–º–∫–Ω—É—Ç–∏ –∫—Ä—É–≥–ª—ñ –º–∞—Ä–∫–µ—Ä–∏
            drawText: true, // –í–∏–º–∫–Ω—É—Ç–∏ —Ç–µ–∫—Å—Ç
            measureControl: true,
            editMode: false, // –í–∏–º–∏–∫–∞—î —Ä–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            cutPolygon: false,
            rotateMode: false,
        });

        // 4. –í–∫–ª—é—á–∞—î–º–æ —Ä–µ–∂–∏–º –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏/–ø–ª–æ—â—ñ
        map.pm.setGlobalOptions({
            measureControl: true,  // –î–æ–¥–∞—î –∫–Ω–æ–ø–∫—É –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
            allowSelfIntersection: true, // –í–∏–º–∏–∫–∞—î –ø–µ—Ä–µ—Ç–∏–Ω —Å–∞–º–∏—Ö —Å–µ–±–µ
            cutPolygon: false, // –í–∏–º–∏–∫–∞—î –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
            editMode: false,
            rotateMode: false,
        });

        map.pm.setPathOptions({
            color: 'red',        // –ö–æ–ª—ñ—Ä –ª—ñ–Ω—ñ–π
            fillColor: 'red',   // –ö–æ–ª—ñ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
            fillOpacity: 0,    // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
            weight: 2           // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
        });

        let distanceTooltip;
    
        map.on('pm:drawstart', function (e) {
            if (e.workingLayer instanceof L.Polyline) {
                let totalDistance = 0;
                let lastLatLng = null;

                e.workingLayer.on('pm:vertexadded', function (event) {
                    let latlngs = e.workingLayer.getLatLngs();
                    let currentLatLng = latlngs[latlngs.length - 1]; 

                    if (lastLatLng !== null) {
                        totalDistance += lastLatLng.distanceTo(currentLatLng);
                    }
                    lastLatLng = currentLatLng;

                    if (distanceTooltip) {
                        map.removeLayer(distanceTooltip);
                    }

                    distanceTooltip = L.tooltip({
                        permanent: false,
                        direction: 'top',
                        className: 'distance-tooltip'
                    })
                        .setLatLng(currentLatLng)
                        .setContent(`${totalDistance.toFixed(2)} –º`)
                        .addTo(map);
                });

                map.once('pm:drawend', function () {
                    if (distanceTooltip) {
                        map.removeLayer(distanceTooltip);
                    }
                });
            }
        });




map.on('pm:drawstart', function (e) {
    if (e.workingLayer instanceof L.Circle) {
        let centerLatLng = null;

        // –°–ª—É—Ö–∞—á –ø–æ–¥—ñ—ó –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É –∫–æ–ª–∞
        map.on('click', function setCenter(event) {
            centerLatLng = event.latlng; // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ü–µ–Ω—Ç—Ä –∫–æ–ª–∞ –Ω–∞ –ø–µ—Ä—à–µ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç—É
            map.off('click', setCenter); // –í–∏–º–∏–∫–∞—î–º–æ —Å–ª—É—Ö–∞—á–∞ –ø—ñ—Å–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É

            // –û–Ω–æ–≤–ª—é—î–º–æ —Ç—É–ª—Ç—ñ–ø –ø—ñ–¥ —á–∞—Å –º–∞–ª—é–≤–∞–Ω–Ω—è
            let moveListener = function (event) {
                let currentLatLng = event.latlng;
                let radius = centerLatLng.distanceTo(currentLatLng); // –í—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É –∫–æ–ª–∞ –¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó —Ç–æ—á–∫–∏

                // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç—É–ª—Ç—ñ–ø
                if (distanceTooltip) {
                    map.removeLayer(distanceTooltip);
                }

                // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ç—É–ª—Ç—ñ–ø –±—ñ–ª—è –∫—É—Ä—Å–æ—Ä–∞
                distanceTooltip = L.tooltip({
                    permanent: false,
                    direction: 'top',
                    className: 'distance-tooltip'
                })
                    .setLatLng(currentLatLng) // –ü–æ–∑–∏—Ü—ñ—è —Ç—É–ª—Ç—ñ–ø–∞ –±—ñ–ª—è –∫—É—Ä—Å–æ—Ä–∞
                    .setContent(`–†–∞–¥—ñ—É—Å: ${radius.toFixed(2)} –º`)
                    .addTo(map);
            };

            map.on('mousemove', moveListener); // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á–∞ –¥–ª—è –ø–æ–¥—ñ—ó mousemove –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É

            // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –º–∞–ª—é–≤–∞–Ω–Ω—è –∫–æ–ª–∞
            map.once('pm:drawend', function () { // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `once` –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–¥—ñ—é —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑
                map.removeLayer(distanceTooltip);
                map.off('mousemove', moveListener); // –í–∏–º–∏–∫–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—É–ª—Ç—ñ–ø–∞ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –º–∞–ª—é–≤–∞–Ω–Ω—è
            });
        });
    }
});









        

    

        var prelunJsonUrl = 'https://mark-000.github.io/pl-power-vis-map.github.io/ukr-pidst.geojson';
        var geoJsonClusterGroup = L.markerClusterGroup({
                                                            spiderfyOnMaxZoom: true, // –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±—ñ
                                                            showCoverageOnHover: false, // –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ–±–ª–∞—Å—Ç—ñ –∫–ª–∞—Å—Ç–µ—Ä—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ
                                                            zoomToBoundsOnClick: true, // –ê–≤—Ç–æ–∑–±—ñ–ª—å—à–µ–Ω–Ω—è –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä
                                                            
                                                            spiderLegPolylineOptions: {
                                                                weight: 0,
                                                            },

                                                            spiderfyShapePositions: function (count, centerPt) {

                                                                var radius = 40; // –†–∞–¥—ñ—É—Å —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è
                                                                var angleStep = (2 * Math.PI) / count;

                                                                return Array.from({ length: count }, (_, i) => {
                                                                    var angle = i * angleStep;
                                                                    return new L.Point(
                                                                        centerPt.x + radius * Math.cos(angle),
                                                                        centerPt.y + radius * Math.sin(angle)
                                                                    );
                                                                });
                                                            },iconCreateFunction: function (cluster) {
                                                                var sumvmerezu = 0;
                                                              

                                                                // –û–¥–∏–Ω –ø—Ä–æ—Ö—ñ–¥ –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –æ–±–æ—Ö –∑–Ω–∞—á–µ–Ω—å
                                                                cluster.getAllChildMarkers().forEach(function (marker) {
                                                                    var value1 = marker.feature.properties["–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (–∑–∞ –¢–£), –ú–í—Ç"];
                                                                    if (!isNaN(value1)) {
                                                                        sumvmerezu += parseFloat(Math.round(value1));
                                                                    
                                                                    }
                                                                });

                                                                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏
                                                                return L.divIcon({
                                                                    html: `
                                                                        <div style="background-color: rgba(0, 123, 255, 0.6); 
                                                                                    font-size: 15px;
                                                                                    border-radius: 50%; 
                                                                                    display: flex;
                                                                                    justify-content: center;
                                                                                    align-items: center;
                                                                                    flex-direction: column;
                                                                                    width: 50px; 
                                                                                    height: 50px; 
                                                                                    text-align: center; 
                                                                                    color: white; 
                                                                                    font-weight: bold;">
                                                                            <div style="color: black;">${sumvmerezu}</div>
                                                                            
                                                                        </div>
                                                                    `,
                                                                    className: 'custom-cluster-icon',
                                                                    iconSize: [50, 50]
                                                                });
                                                            }
                                                          
                                                        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ Rodzaj instalacji
        function getColorByInstallationType(type) {
            if (type === '–°–ï–°') {
                return 'purple'; // –§—ñ–æ–ª–µ—Ç–æ–≤–∏–π
            } else if (type === '–í–ï–°') {
                return 'blue'; // –°–∏–Ω—ñ–π
            } else if (type === '–£–ó–ï') {
                return 'orange'; // –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π
            } else {
                return 'gray'; // –°—ñ—Ä–∏–π (–¥–ª—è —ñ–Ω—à–∏—Ö –∑–Ω–∞—á–µ–Ω—å)
            }
        }

        fetch(prelunJsonUrl)
            .then(response => response.json())
            .then(geojsonData => {
                var gprelunJsonLayer = L.geoJSON(geojsonData, {
                    pointToLayer: function (feature, latlng) {
                    var color = getColorByInstallationType(feature.properties['–í–∏–¥ –¥–∂–µ—Ä–µ–ª–∞ –µ–Ω–µ—Ä–≥—ñ—ó']);
                    var marker = L.circleMarker(latlng, {
                        radius: 8,
                        fillColor: color,
                        color: color,
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 1
                    });

                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å—É
                    marker.bindTooltip(`
                        
                        ${feature.properties['–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (–∑–∞ –¢–£), –ú–í—Ç'] || '–ù–µ–≤—ñ–¥–æ–º–æ'}<br>
                    `, {
                        permanent: true,
                        direction: 'top',
                        className: 'custom-tooltip1'
                    });
                    marker.bindPopup(`
                        <b>–ü–° 220-750 –∫–í:</b> ${feature.properties['–ü–° 220-750 –∫–í'] || '–ù–µ–≤—ñ–¥–æ–º–æ'}<br>
                        <b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å:</b> ${feature.properties['–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (–∑–∞ –¢–£), –ú–í—Ç'] || '–ù–µ–≤—ñ–¥–æ–º–æ'} –ú–í—Ç<br>
                    `);

                    return marker;
                }
                });
                geoJsonClusterGroup.addLayer(gprelunJsonLayer); 
               
                var geojsonukrline = "https://mark-000.github.io/pl-power-vis-map.github.io/ukr-line-filter-all.geojson"
                fetch(geojsonukrline)
                                    .then(response => response.json())
                                    .then(reconsGeojsonData => {
                                        var reconsLayer = L.geoJSON(reconsGeojsonData, {
                                            style: function(feature) {
                                                // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∑–º—ñ–Ω–∏ –∫–æ–ª—å–æ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è voltage
                                                if (feature.properties.voltage && feature.properties.voltage.includes('220')) {
                                                    return { color: 'green', weight: 2.5, opacity: 1 }; // –ó–µ–ª–µ–Ω–∏–π –¥–ª—è 220
                                                } else if (feature.properties.voltage && feature.properties.voltage.includes('400')) {
                                                    return { color: '#f505fa', weight: 2.5, opacity: 1 }; // –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è 400
                                                }else if (feature.properties.voltage && feature.properties.voltage.includes('750')) {
                                                    return { color: '#ba1806', weight: 2.5, opacity: 1 }; // –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è 400
                                                } else {
                                                    return { color: '#0572a1', weight: 2.5, opacity: 1 }; // –§—ñ–æ–ª–µ—Ç–æ–≤–∏–π –¥–ª—è –≤—Å—å–æ–≥–æ —ñ–Ω—à–æ–≥–æ
                                                }
                                            },
                                            onEachFeature: function(feature, layer) {
                                                layer.bindPopup(`
                                                    <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.name || 'Unknown'}<br>
                                                    <b>–ù–∞–ø—Ä—É–≥–∞:</b> ${feature.properties.voltage || 'Unknown'}
                                                `);
                                            }
                                        });
                                        var geojsonukrline110 = "https://mark-000.github.io/pl-power-vis-map.github.io/line-ua-110-150.geojson"
                                fetch(geojsonukrline110)
                                    .then(response => response.json())
                                    .then(reconsGeojsonData => {
                                        var Layer110 = L.geoJSON(reconsGeojsonData, {
                                            style: function(feature) {
                                                // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∑–º—ñ–Ω–∏ –∫–æ–ª—å–æ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è voltage
                                                if (feature.properties.voltage && feature.properties.voltage.includes('110')) {
                                                    return { color: '#b89023', weight: 1.5, opacity: 1 }; // –ó–µ–ª–µ–Ω–∏–π –¥–ª—è 220
                                                }  else {
                                                    return { color: '#b89023', weight: 1.5, opacity: 1 }; // –§—ñ–æ–ª–µ—Ç–æ–≤–∏–π –¥–ª—è –≤—Å—å–æ–≥–æ —ñ–Ω—à–æ–≥–æ
                                                }
                                            },
                                            onEachFeature: function(feature, layer) {
                                                layer.bindPopup(`
                                                    <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.name || 'Unknown'}<br>
                                                    <b>–ù–∞–ø—Ä—É–≥–∞:</b> ${feature.properties.voltage || 'Unknown'}
                                                `);
                                            }
                                        });
                                        var geojsonUrlBorder = 'https://mark-000.github.io/pl-power-vis-map.github.io/Ukraine_Border.geojson';
                                        map.createPane('borderPane');
                                               //map.getPane('borderPane').style.zIndex = 400;

                                                fetch(geojsonUrlBorder)
                                                    .then(response => response.json())
                                                    .then(borderGeojsonData => {
                                                        borderLayer = L.geoJSON(borderGeojsonData, {
                                                            pane: 'borderPane',
                                                            style: {
                                                                color: '#595857', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                fillOpacity: 0
                                                            },
                                                            interactive: false
                                                        });

                                        var geojsonUrlbuffer50kmpidst = 'https://mark-000.github.io/pl-power-vis-map.github.io/buffer-for-proekty-50km.geojson';
                                        
                                               //map.getPane('borderPane').style.zIndex = 400;

                                                fetch(geojsonUrlbuffer50kmpidst)
                                                    .then(response => response.json())
                                                    .then(borderGeojsonData => {
                                                        buffer50pidstLayer = L.geoJSON(borderGeojsonData, {
                                                            style: {
                                                                color: '#f5076a', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                weight: 2, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                fillOpacity: 0,
                                                            },
                                                            interactive: false
                                                        });
                                                        
                                                        var geojsonUrlNEK = 'https://mark-000.github.io/pl-power-vis-map.github.io/nek-substations.geojson';
                                                        fetch(geojsonUrlNEK)
                                                            .then(response => response.json())
                                                            .then(projektyGeojsonData => {
                                                                NEKLayer = L.geoJSON(projektyGeojsonData, {
                                                                    pointToLayer: function(feature, latlng) {
                                                                        return L.circleMarker(latlng, {
                                                                            radius: 6, // –†–∞–¥—ñ—É—Å —Ç–æ—á–∫–∏
                                                                            fillColor: "black", // –ö–æ–ª—ñ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                                                                            color: "yellow", // –ö–æ–ª—ñ—Ä –æ–±–≤–µ–¥–µ–Ω–Ω—è
                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–µ–¥–µ–Ω–Ω—è
                                                                            opacity: 1, // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –æ–±–≤–µ–¥–µ–Ω–Ω—è
                                                                            fillOpacity: 1 // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                                                                        });
                                                                    },
                                                                    onEachFeature: function(feature, layer) {
                                                                        layer.bindPopup(`
                                                                            <b>–ü—ñ–¥—Å—Ç–∞–Ω—Ü—ñ—è:</b> ${feature.properties.Substation || 'Unknown'}<br>
                                                                            <b>–õ–æ–∫–∞—Ü—ñ—è:</b> ${feature.properties.Location || 'Unknown'}<br>
                                                                            <b>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä–∏:</b> ${feature.properties.Transformers || 'Unknown'}
                                                                        `);
                                                                    }
                                                                });
                                                                var geojsonUrlPUA = 'https://mark-000.github.io/pl-power-vis-map.github.io/p-stations-ua.geojson';
                                                                fetch(geojsonUrlPUA)
                                                                    .then(response => response.json())
                                                                    .then(projektyGeojsonData => {
                                                                        PUALayer = L.geoJSON(projektyGeojsonData, {
                                                                            pointToLayer: function(feature, latlng) {
                                                                                var size = feature.properties.power / 1500; // –†–æ–∑–º—ñ—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ (–º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π)
                                                                                const size2 = Math.sqrt(size) * 2;

                                                                                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É —Å—Ç–∞–Ω—Ü—ñ—ó
                                                                                var color;
                                                                                switch (feature.properties.type) {
                                                                                    case '–ê–ï–°':
                                                                                        color = '#8B1A10'; // –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –ê–ï–°
                                                                                        break;
                                                                                    case '–¢–ï–°':
                                                                                        color = '#b89023'; // –ñ–æ–≤—Ç–∏–π –¥–ª—è –¢–ï–°
                                                                                        break;
                                                                                    case '–ì–ï–°':
                                                                                    case '–ì–ê–ï–°':
                                                                                        color = '#0572a1'; // –°–∏–Ω—ñ–π –¥–ª—è –ì–ï–° –∞–±–æ –ì–ï–ê–°
                                                                                        break;
                                                                                    default:
                                                                                        color = 'black'; // –ö–æ–ª—ñ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
                                                                                        break;
                                                                                }

                                                                                const squareIcon = L.divIcon({
                                                                                    className: 'custom-marker',
                                                                                    html: `<div style="
                                                                                        width: ${size2 * 15}px;
                                                                                        height: ${size2 * 15}px;
                                                                                        background-color: ${color};
                                                                                        opacity: 0.7;
                                                                                        border: 1px solid black;
                                                                                        transform: translate(-50%, -50%);
                                                                                        box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;
                                                                                    "></div>`,
                                                                                    iconSize: [size * 17, size * 17], // –ú–æ–∂–Ω–∞ –ø—ñ–¥–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏
                                                                                    iconAnchor: [size, size], // –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏
                                                                                });

                                                                                return L.marker(latlng, { icon: squareIcon });
                                                                            },
                                                                            onEachFeature: function(feature, layer) {
                                                                                layer.bindPopup(`
                                                                                    <b style='font-size: 15px;'> ${feature.properties.station || 'Unknown'}</b><br>
                                                                                    <b>–¢–∏–ø:</b> ${feature.properties.type || 'Unknown'}<br>
                                                                                    <b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å:</b> ${feature.properties.power || 'Unknown'}
                                                                                `);
                                                                            }
                                                                        });
                                                                    

//----------------------------------------------------------------ekologia-----------------------------------------------------------------

                                                                        var opacity700 = 0.3
                                                                        var color700 = '#42e3f5'
                                                                        var geojsonUrlLvivbuf = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_lviv.geojson';
                                                                            fetch(geojsonUrlLvivbuf)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    buflvivLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlvolin = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_volin.geojson';
                                                                            fetch(geojsonUrlvolin)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    volinLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlzakarpatsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_zakarpatsk.geojson';
                                                                            fetch(geojsonUrlzakarpatsk)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    zakarpatskLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlrivne = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_rivne.geojson';
                                                                            fetch(geojsonUrlrivne)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    rivneLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlternopil = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_ternopil.geojson';
                                                                            fetch(geojsonUrlternopil)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    ternopilLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlfrankivsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_frankivsk.geojson';
                                                                            fetch(geojsonUrlfrankivsk)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    frankivskLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlchernivci = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_chernivci.geojson';
                                                                            fetch(geojsonUrlchernivci)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    chernivciLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlhmelnitsk = 'https://mark-000.github.io/pl-power-vis-map.github.io/merged_buffers_hmelnitsk.geojson';
                                                                            fetch(geojsonUrlhmelnitsk)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    hmelnitskLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: color700, // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: opacity700
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlaerodromi = 'https://mark-000.github.io/pl-power-vis-map.github.io/aerodromi_buffers.geojson';
                                                                            fetch(geojsonUrlaerodromi)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    aerodromiLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: '#cf4b44', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 2, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: 0
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
                                                                                    var geojsonUrlaerodromi16 = 'https://mark-000.github.io/pl-power-vis-map.github.io/aerodromi_buffers_16.geojson';
                                                                            fetch(geojsonUrlaerodromi16)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    aerodromiLayer16 = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: '#cf4b44', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: 0.3
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -998  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });

                                                                                         //map.getPane('borderPane').style.zIndex = 400;
                                                                                         var waterPolyLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/water_poly_ramsar/{z}/{x}/{y}.png');
                                                                                         var dzkPzfLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__pzf/{z}/{x}/{y}.png');
                                                                                         var cadastrLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/parcels/{z}/{x}/{y}.png');
                                                                                         var geojsonUrlemerald = 'https://mark-000.github.io/pl-power-vis-map.github.io/amerald_zahid.geojson';
                                                                            fetch(geojsonUrlemerald)
                                                                                .then(response => response.json())
                                                                                .then(borderGeojsonData => {
                                                                                    emeraldLayer = L.geoJSON(borderGeojsonData, {
                                                                                        style: {
                                                                                            color: '#3b8f51', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                                                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                                                                            fillOpacity: 0.3
                                                                                        },
                                                                                        interactive: false,
                                                                                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                                                                                    });
//----------------------------------------------------------------tif-----------------------------------------------------------------

var geotiffUrlw = "https://mark-000.github.io/pl-power-vis-map.github.io/UKR_wind-speed_100m-.tif";  
var layerwtif;
var popupActive = false;
var windLegend = null;

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–µ–≥–µ–Ω–¥–∏ –≤—ñ—Ç—Ä—É
function createWindLegend() {
    if (windLegend) return; // –Ø–∫—â–æ –ª–µ–≥–µ–Ω–¥–∞ –≤–∂–µ —î, –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤—É

    windLegend = L.control({ position: 'bottomleft' });

    windLegend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'info legend wind-legend'); // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å –¥–ª—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –ª–µ–≥–µ–Ω–¥
        div.innerHTML = `
            <b>–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ—Ç—Ä—É</b><br>
            <i style="background: #f4fc03"></i> 7 - 7.3<br>
            <i style="background: #fcce03"></i> 7.31 - 7.6<br>
            <i style="background: #fc9003"></i> 7.61 - 7.9<br>
            <i style="background: #fc4e03"></i> 7.91 - 8.2<br>
            <i style="background: #d60606"></i> 8.21 - 8.5<br>
            <i style="background: #6e0000"></i> 8.51+<br>
        `;
        div.style.background = 'white';
        div.style.padding = '10px';
        div.style.border = '1px solid #333';
        div.style.borderRadius = '5px';
        return div;
    };
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ª–µ–≥–µ–Ω–¥–∏ –≤—ñ—Ç—Ä—É
function toggleWindLegend(show) {
    if (show) {
        if (!windLegend) createWindLegend();
        windLegend.addTo(map);
    } else {
        if (windLegend) {
            map.removeControl(windLegend);
        }
    }
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoTIFF
fetch(geotiffUrlw)
    .then(res => res.arrayBuffer())
    .then(arrayBuffer => {
        parseGeoraster(arrayBuffer).then(georaster => {
            map.createPane('customPane');
            map.getPane('customPane').style.zIndex = 250;

            layerwtif = new GeoRasterLayer({
                georaster: georaster,
                opacity: 0.5,
                pixelValuesToColorFn: vals => {
                    let v = vals[0];

                    if (isNaN(v) || v < 7) {
                        return null; 
                    } else if (v >= 7 && v <= 7.3) {
                        return '#f4fc03';
                    } else if (v > 7.3 && v <= 7.6) {
                        return '#fcce03';
                    } else if (v > 7.6 && v <= 7.9) {
                        return '#fc9003';
                    } else if (v > 7.9 && v <= 8.2) {
                        return '#fc4e03';
                    } else if (v > 8.2 && v <= 8.5) {
                        return '#d60606';
                    } else if (v > 8.5) {
                        return '#6e0000';
                    }
                    return null;
                },
                resolution: 128,
                pane: 'customPane'
            });

            // –î–æ–¥–∞—î–º–æ –ø–æ–¥—ñ—é –Ω–∞ –∫–ª—ñ–∫ –¥–ª—è –ø–æ–∫–∞–∑—É –∑–Ω–∞—á–µ–Ω—å
            map.on("click", function(event) {
                if (popupActive) {
                    var lat = event.latlng.lat;
                    var lng = event.latlng.lng;

                    var value = geoblaze.identify(georaster, [lng, lat]);
                    value = Number(value);
                    var valueFormatted = value.toFixed(5);

                    if (value !== undefined) {
                        L.popup()
                            .setLatLng([lat, lng])
                            .setContent(valueFormatted)
                            .openOn(map);
                    } else {
                        L.popup()
                            .setLatLng([lat, lng])
                            .setContent("No data available for this point")
                            .openOn(map);
                    }
                }
            });
        });

        // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —à–∞—Ä–æ–º —ñ –ª–µ–≥–µ–Ω–¥–æ—é
        var geoTiffControl = L.Control.extend({
            onAdd: function(map) {
                var button = L.DomUtil.create('button');
                button.innerHTML = 'üå™Ô∏è';
                button.style.backgroundColor = '#ffffff';
                button.style.border = '1px solid #333';
                button.style.padding = '5px';
                button.style.fontSize = '25px';
                button.style.cursor = 'pointer';
                button.style.borderRadius = '5px';

                L.DomEvent.on(button, 'click', function() {
                    popupActive = !popupActive;  

                    if (map.hasLayer(layerwtif)) {
                        map.removeLayer(layerwtif);
                        toggleWindLegend(false);
                    } else {
                        map.addLayer(layerwtif);
                        toggleWindLegend(true);
                    }
                });

                return button;
            },
            position: 'topleft'
        });

        map.addControl(new geoTiffControl());
    });







//---------------------------------------------------------------------------------------------------------------------------------






var geojsonUrlNEK = 'https://mark-000.github.io/pl-power-vis-map.github.io/nek-pidstancii-pidkluch.geojson';

fetch(geojsonUrlNEK)
    .then(response => response.json())
    .then(projektyGeojsonData => {
        // –®–∞—Ä –¥–ª—è potuznist35
        var layerPotuznist35 = L.geoJSON(projektyGeojsonData, {
            filter: function(feature) {
                return feature.properties.potuznist35 != null && feature.properties.potuznist35 > 0;
            },
            pointToLayer: function(feature, latlng) {
                let power = feature.properties.potuznist35;

                let marker = L.circleMarker(latlng, {
                    radius: Math.sqrt(power) * 1.2, // –†–æ–∑–º—ñ—Ä —Ç–æ—á–∫–∏ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ
                    fillColor: "blue",
                    color: "black",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });

                let tooltipOffset = -Math.sqrt(power) * 1.2; 

                marker.bindTooltip(`${power}`, {
                    permanent: true,
                    direction: 'top',
                    className: 'custom-tooltip110', // –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–ª–∞—Å
                    offset: [0, tooltipOffset]
                });

                marker.bindPopup(`
                    <b>–ü–°:</b> ${feature.properties.pidstancia}<br>
                    <b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ 35–∫–≤:</b> ${power} –ú–í—Ç<br>
                `);

                return marker;
            }
        });


        // –®–∞—Ä –¥–ª—è potuznist110
        var clusterGroup110 = L.markerClusterGroup({
            showCoverageOnHover: false,
            iconCreateFunction: function(cluster) {
                let markers = cluster.getAllChildMarkers();
                let totalPower = markers.reduce((sum, marker) => sum + (marker.options.power || 0), 0);
                
                return L.divIcon({
                    html: `<div style="background-color: green;
                                opacity: 0.8;
                                font-size: 15px;
                                border-radius: 50%; 
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                flex-direction: column;
                                width: 50px; 
                                height: 50px; 
                                text-align: center; 
                                color: white; 
                                font-weight: bold;">
                        ${totalPower}
                    </div>`,
                    className: 'custom-cluster',
                    iconSize: [40, 40]
                });
            }
        });

// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ GeoJSON
fetch(geojsonUrlNEK)
    .then(response => response.json())
    .then(projektyGeojsonData => {
        var layerPotuznist110 = L.geoJSON(projektyGeojsonData, {
            filter: function(feature) {
                return feature.properties.potuznist110 != null && feature.properties.potuznist110 > 0;
            },
            pointToLayer: function(feature, latlng) {
                let power = feature.properties.potuznist110;
                let pidstancia = feature.properties.pidstancia.toLowerCase(); // –ü—Ä–∏–≤–æ–¥–∏–º–æ –¥–æ –Ω–∏–∂–Ω—å–æ–≥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å–ª—ñ–≤ "—Ä–æ–∑–¥—ñ–ª" –∞–±–æ "–∑–∞—Ö—ñ–¥–Ω–∞"
                let fillColor = "green"; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–µ–ª–µ–Ω–∏–π
                if (pidstancia.includes("—Å—Ç—Ä–∏–π") || pidstancia.includes("–∫–∞–ª—É—à") || pidstancia.includes("–≤–æ–ª–æ–≤–µ—Ü—å") || pidstancia.includes("—Ç–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞" || pidstancia.includes("—Ö–º–µ–ª—å–Ω–∏—Ü—å–∫–∞"))) {
                    fillColor = "yellow"; // –ó–º—ñ–Ω—é—î–º–æ –∫–æ–ª—ñ—Ä –Ω–∞ –∂–æ–≤—Ç–∏–π, —è–∫—â–æ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è
                }

                let marker = L.circleMarker(latlng, {
                    radius: Math.sqrt(power) * 1.2, // –†–æ–∑–º—ñ—Ä —Ç–æ—á–∫–∏ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ
                    fillColor: fillColor,
                    color: "black",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });

                let tooltipOffset = -Math.sqrt(power) * 1.2;

                marker.bindTooltip(`
                        ${power}<br>
                    `, {
                        permanent: true,
                        direction: 'top',
                        className: 'custom-tooltip110',
                        offset: [0, tooltipOffset]
                    });
                marker.bindPopup(`
                        <b>–ü–°:</b> ${feature.properties.pidstancia}<br>
                        <b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ 110–∫–≤:</b> ${power} –ú–í—Ç<br>
                    `);
                marker.options.power = power;
                return marker;
            }
        });


        clusterGroup110.addLayer(layerPotuznist110);                                                      

                // –î–æ–¥–∞–≤–∞–Ω–Ω—è —à–∞—Ä—É –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ—ó –≥—Ä—É–ø–∏ 



        var geojsonUrsmall_14_01 = 'https://mark-000.github.io/pl-power-vis-map.github.io/14-01-zahid-small.geojson';

        fetch(geojsonUrsmall_14_01)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                small_14_01 = L.geoJSON(projektyGeojsonData, {
                    style: function(feature) {
                        return {
                            fillColor: "purple", // –ö–æ–ª—ñ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—É
                            color: "black", // –ö–æ–ª—ñ—Ä –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            weight: 3, // –¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            opacity: 1, // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            fillOpacity: 0.6 // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>–ù–æ–º–µ—Ä:</b> ${feature.properties["landuse.cadnum"] || 'Unknown'}<br>
                            <b>–ü–ª–æ—â–∞:</b> ${feature.properties.area || 'Unknown'}<br>
                            <b>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</b> ${feature.properties.use || 'Unknown'}<br>
                            <b>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</b> ${feature.properties.category || 'Unknown'}<br>
                            <b>–í–ª–∞—Å–Ω—ñ—Å—Ç—å:</b> ${feature.properties.ownership || 'ownership'}<br>
                        `);
                    }
                });
                var geojsonKonkurentyzahidvitr = 'https://mark-000.github.io/pl-power-vis-map.github.io/vitr-zahidnii-2z3c.geojson';

        fetch(geojsonKonkurentyzahidvitr)
            .then(response => response.json())
            .then(projektyGeojsonData => {
                vitr_zahid = L.geoJSON(projektyGeojsonData, {
                    style: function(feature) {
                        return {
                            fillColor: "blue", // –ö–æ–ª—ñ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—É
                            color: "black", // –ö–æ–ª—ñ—Ä –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            weight: 3, // –¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            opacity: 1, // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –æ–±–≤–µ–¥–µ–Ω–Ω—è
                            fillOpacity: 0.6 // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup(`
                            <b>–ù–æ–º–µ—Ä:</b> ${feature.properties.cadnum || 'Unknown'}<br>
                            <b>LN:</b> ${feature.properties.LN || 'Unknown'}<br>
                        `);
                    }
                });

                var geojsonUrlkonkurenty16 = 'https://mark-000.github.io/pl-power-vis-map.github.io/konkurenty_buffers_16.geojson';
                            fetch(geojsonUrlkonkurenty16)
                                .then(response => response.json())
                                .then(borderGeojsonData => {
                                    console.log(geojsonUrlkonkurenty16)
                                    konkurentyLayer16 = L.geoJSON(borderGeojsonData, {
                                        style: function(feature) {
                                        return {
                                            color: 'purple', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                            fillOpacity: 0.5
                                        };
                                        },
                                        onEachFeature: function(feature, layer) {
                                            layer.bindPopup(`
                                                <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.name || 'Unknown'}<br>
                                            `);
                                        }
                                        
                                    });
            

                var geojsonUrlAnimal = 'https://mark-000.github.io/pl-power-vis-map.github.io/animalss.geojson';
                fetch(geojsonUrlAnimal)
                    .then(response => response.json())
                    .then(projektyGeojsonData => {
                        // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –¥–∞–Ω—ñ: —Ç—ñ–ª—å–∫–∏ –¥–µ –∫–ª–∞—Å = 'Aves' –∞–±–æ —Ä—è–¥ = 'Chiroptera'
                        let filteredData = {
                            type: "FeatureCollection",
                            features: projektyGeojsonData.features.filter(feature => 
                                feature.properties.class === "Aves" || feature.properties.family === "Vespertilionidae" || feature.properties.family === "Rhinolophidae"
                            )
                        };

                        // –°—Ç–≤–æ—Ä—é—î–º–æ —à–∞—Ä –∑ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
                        animalLayer = L.geoJSON(filteredData, {
                            pointToLayer: function(feature, latlng) {
                                return L.circleMarker(latlng, {
                                    radius: 4, 
                                    fillColor: "red",
                                    color: "black",
                                    weight: 1,
                                    opacity: 1,
                                    fillOpacity: 1
                                });
                            },
                            onEachFeature: function(feature, layer) {
                                layer.bindPopup(`
                                    <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.scientificName || 'Unknown'}<br>
                                    <b>–ö–ª–∞—Å:</b> ${feature.properties.class || 'Unknown'}<br>
                                    <b>–†—è–¥:</b> ${feature.properties.order || 'Unknown'}<br>
                                    <b>–î–∞—Ç–∞:</b> ${feature.properties.eventDate || 'Unknown'}
                                `);
                            }
                        })

                        var geojsonUrlpidstobl = 'https://mark-000.github.io/pl-power-vis-map.github.io/obl-pidstancii-all-zahid.geojson';
                        fetch(geojsonUrlpidstobl)
    .then(response => response.json())
    .then(projektyGeojsonData => {
        // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ —î —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è voltage >= 35000
        function voltageFilter(feature) {
            if (!feature.properties.voltage) return false; // –Ø–∫—â–æ –ø–æ–ª–µ –≤—ñ–¥—Å—É—Ç–Ω—î
            let voltages = feature.properties.voltage.split(";").map(v => parseInt(v.trim())); // –†–æ–∑–¥—ñ–ª—è—î–º–æ —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —É —á–∏—Å–ª–∞
            return voltages.some(v => v >= 35000); // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è ‚â• 35000
        }

        // –§—ñ–ª—å—Ç—Ä—É—î–º–æ GeoJSON
        let filteredData = {
            type: "FeatureCollection",
            features: projektyGeojsonData.features.filter(voltageFilter)
        };

        // –°—Ç–≤–æ—Ä—é—î–º–æ —à–∞—Ä –∑ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
        oblpidstLayer = L.geoJSON(filteredData, {
            pointToLayer: function(feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 4,
                    fillColor: "blue",
                    color: "black",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 1
                });
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup(`
                    <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.full_name || feature.properties.name || 'Unknown'}<br>
                    <b>–ù–∞–ø—Ä—É–≥–∞:</b> ${feature.properties.voltage || 'Unknown'}<br>
                    <b>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å:</b> ${feature.properties.rating || 'Unknown'}<br>
                    <b>–û–ø–µ—Ä–∞—Ç–æ—Ä:</b> ${feature.properties.operator || 'Unknown'}
                `);
            }
        });

                        
                                         // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏

          
                
//----------------------------------------------------------------shari-----------------------------------------------------------------
                // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞ —à–∞—Ä—ñ–≤
                var baseTree = {
                    label: "<b>–ë–∞–∑–æ–≤—ñ –∫–∞—Ä—Ç–∏</b>",
                    children: [
                        { label: "OpenStreetMap", layer: osmLayer, radioGroup: "basemap" },
                        { label: "Google Map", layer: googleLayer, radioGroup: "basemap" }
                    ]
                };

                // –î–µ—Ä–µ–≤–æ —à–∞—Ä—ñ–≤
                var overlaysTree = {
                    label: "<b>–®–∞—Ä–∏</b>",
                    selectAllCheckbox: true,  // –î–æ–¥–∞—î —á–µ–∫–±–æ–∫—Å –¥–ª—è –≤–∏–±–æ—Ä—É –≤—Å—ñ—Ö —à–∞—Ä—ñ–≤
                    children: [
                        { label: "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –º–µ–∂—ñ", layer: borderLayer },
                        { label: "–ö–∞–¥–∞—Å—Ç—Ä –ø—ñ–¥–∫–ª–∞–¥–∫–∞", layer: cadastrLayer },
                        { 
                            label: "<b>–ï–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ</b>", 
                            children: [
                                { label: "–ù–ï–ö –ø—ñ–¥—Å—Ç–∞–Ω—Ü—ñ—ó", layer: NEKLayer },
                                { label: "–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è", layer: geoJsonClusterGroup },
                                { label: "–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ 35–∫–í", layer: layerPotuznist35 },
                                { label: "–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ 110–∫–í", layer: clusterGroup110 },
                                { label: "–ï–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü—ñ—ó", layer: PUALayer },
                                { label: "–û–±–ª –ø—ñ–¥—Å—Ç–∞–Ω—Ü—ñ—ó", layer: oblpidstLayer },
                                { label: "–õ—ñ–Ω—ñ—ó 220+", layer: reconsLayer },
                                { label: "–õ—ñ–Ω—ñ—ó 110", layer: Layer110 }
                            ]
                        },
                        { 
                            label: "<b>–ü—Ä–æ–µ–∫—Ç–∏</b>", 
                            collapsed: true,
                            children: [
                                { label: "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏", layer: konkurentyLayer16 },
                                { label: "–í—ñ—Ç—Ä–æ–ø–∞—Ä–∫ –∑–∞—Ö—ñ–¥–Ω–∏–π", layer: vitr_zahid },
                                { label: "14.01 –º–∞–ª–µ–Ω—å–∫—ñ", layer: small_14_01 },
                                { label: "50–∫–º –¥–ª—è –ø—Ä–æ–µ–∫—Ç—ñ–≤", layer: buffer50pidstLayer }
                            ]
                        },
                        { 
                            label: "<b>–û–±–º–µ–∂–µ–Ω–Ω—è</b>",
                            collapsed: true, 
                            children: [
                                { label: "–õ—å–≤—ñ–≤", layer: buflvivLayer },
                                { label: "–í–æ–ª–∏–Ω—å", layer: volinLayer },
                                { label: "–ó–∞–∫–∞—Ä–ø–∞—Ç—Ç—è", layer: zakarpatskLayer },
                                { label: "–†—ñ–≤–Ω–µ", layer: rivneLayer },
                                { label: "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", layer: ternopilLayer },
                                { label: "–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", layer: frankivskLayer },
                                { label: "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", layer: chernivciLayer },
                                { label: "–•–º–µ–ª—å–Ω–∏—Ü—å–∫", layer: hmelnitskLayer },
                                { label: "–ü—Ä–∏–∞–µ—Ä–æ–¥—Ä–æ–º–Ω–∞ 50–∫–º", layer: aerodromiLayer },
                                { label: "–ü—Ä–∏–∞–µ—Ä–æ–¥—Ä–æ–º–Ω–∞ 16–∫–º", layer: aerodromiLayer16 },

                            ]
                        },
                        { 
                            label: "<b>–ü—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω—ñ –¥–∞–Ω—ñ</b>", 
                            collapsed: true,  // ‚ùó –ó–≥–æ—Ä–Ω—É—Ç–∞ –≥—Ä—É–ø–∞
                            children: [
                                { label: "<span>–ü—Ç–∞—Ö–∏, –∫–∞–∂–∞–Ω–∏ (–ß–ö)</span>", layer: animalLayer },
                                { label: "<span>–†–∞–º—Å–∞—Ä—Å—å–∫–∞ –∫–æ–Ω–≤–µ–Ω—Ü—ñ—è</span>", layer: waterPolyLayer },
                                { label: "<span>–ü—Ä–∏—Ä–æ–¥–Ω–æ-–∑–∞–ø–æ–≤—ñ–¥–Ω–∏–π —Ñ–æ–Ω–¥</span>", layer: dzkPzfLayer },
                                { label: "<span>–°–º–∞—Ä–∞–≥–¥–æ–≤–∞ –º–µ—Ä–µ–∂–∞</span>", layer: emeraldLayer }
                            ]
                        }
                        
                    ]
                };

                // –î–æ–¥–∞—î–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—å —à–∞—Ä—ñ–≤
                var layerControl = L.control.layers.tree(baseTree, overlaysTree, {
                    namedToggle: false,  
                    selectorBack: false, 
                    closedSymbol: "‚ñ∂",  
                    openedSymbol: "‚ñº",  
                    collapsed: true

                }).addTo(map);

                
                reconsLayer.addTo(map);
                clusterGroup110.addTo(map);
                //geoJsonClusterGroup.addTo(map);
                borderLayer.addTo(map);
                legend.addTo(map)
            })
            .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
            })
            .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
        })
        .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
    })
    .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));

    })
    .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
                                                
    </script>

    <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —á–µ—Ä–µ–∑ IIFE –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä—É-->
    <script>
        (async function() {
            window.Pbf = (await import("https://cdn.skypack.dev/pbf")).default;
            window.VectorTile = (await import("https://cdn.skypack.dev/@mapbox/vector-tile")).VectorTile;
        })();
    </script>
    
    <script defer src="./script-cadastr.js"></script>
</body>
</html>
