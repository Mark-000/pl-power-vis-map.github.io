<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeKadastrMap</title>
    <link rel="icon" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/images/leaflogo.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Pacifico&family=Roboto+Slab:wght@100..900&family=Sofia+Sans:ital,wght@1,1..1000&family=Ysabeau+SC:wght@1..1000&display=swap" rel="stylesheet">
    
   
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            
            height: 100%;
            width: 100%;
            /*font-family: 'Open Sans', sans-serif !important;*/
            font-family: "Balsamiq Sans", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        .export-import-tooltip{
            background-color: rgba(255, 255, 128, .5);
            
        }
        .imp-exp-block{
            display: flex;
            align-items: center;
            align-content: center;
            flex-direction: column;
            background-color: white; ;
            margin-top: 30%;
        }
        .leaflet-control{
            background: white;
            border: none !important;
            box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px !important;
        }
        .leaflet-control-layers-list{
            margin: 5px;
        }
        .leaflet-control-layers-list .leaflet-layerstree-header:hover{
            /*text-decoration: underline;*/
            background-color: rgb(240, 240, 240);
            cursor: pointer;
        }
        .leaflet-control-layers {
            transition: max-height 1s ease-out, opacity 0.3s ease-out;
            max-height: 20vh; 
            overflow: hidden;
            opacity: 1;
            }

            .leaflet-control-layers:hover {
            max-height: 100vh; 
            opacity: 1;
            }
        
        
        .custom-tooltip {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid black;
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .transperent{
            background-color: #0572a1;
        }
        .leaflet-tooltip.custom-tooltip1{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip1:before {
            display: none !important; /* –í–∏–º–∏–∫–∞—î —Å—Ç—Ä—ñ–ª–æ—á–∫—É */
        }
        .leaflet-tooltip.custom-tooltip110{
            margin-top: 1.5px;
            background-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            border: none;
            font-size: 14px;
            font-weight: bold;
        }
        .leaflet-tooltip.custom-tooltip110:before {
            display: none !important; /* –í–∏–º–∏–∫–∞—î —Å—Ç—Ä—ñ–ª–æ—á–∫—É */
        }
        .info-control {
            padding: 3.5px 3.5px 0px 3.5px;
            border-radius: 2px;
        }
        .info-control:hover {
            cursor: pointer;
        }
        .legend i {
            display: inline-block;
            width: 20px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid black;
        }

        .layer-measureboundary {
    stroke: red !important; /* –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä */
    stroke-width: 4px !important; /* –¢–æ–≤—â–∏–Ω–∞ */
    opacity: 0.8 !important; /* –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å */
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –∫—ñ–Ω—Ü–µ–≤–æ—ó –ª—ñ–Ω—ñ—ó (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è) */
.layer-measure-resultline {
    stroke: rgb(255, 0, 0) !important; /* –°–∏–Ω—ñ–π –∫–æ–ª—ñ—Ä */
    stroke-width: 4px !important; /* –¢–æ–≤—â–∏–Ω–∞ */
    opacity: 1 !important;
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –ø–ª–æ—â—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è */
.layer-measure-resultarea {
    fill: rgba(192, 70, 77, 0.3) !important; /* –ü—Ä–æ–∑–æ—Ä–∏–π –∑–µ–ª–µ–Ω–∏–π */
    stroke: rgb(255, 0, 0) !important; /* –û–±–≤–µ–¥–µ–Ω–Ω—è –∑–µ–ª–µ–Ω–µ */
    stroke-width: 4px !important;
}

/* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è —Ç–æ—á–æ–∫ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è */
.layer-measurevertex {
    fill: rgb(255, 0, 0) !important;
    stroke: black !important;
    stroke-width: 4px;
    r: 6px; /* –†–∞–¥—ñ—É—Å —Ç–æ—á–∫–∏ */
}

.leaflet-pm-text {
    font-size: 20px;  /* –ó–∞–¥–∞–π—Ç–µ –±–∞–∂–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É */
    font-weight: bold; /* –ú–æ–∂–Ω–∞ —Ç–∞–∫–æ–∂ –∑–º—ñ–Ω–∏—Ç–∏ —Ç–æ–≤—â–∏–Ω—É —à—Ä–∏—Ñ—Ç—É */
    color: red; /* –ö–æ–ª—ñ—Ä —à—Ä–∏—Ñ—Ç—É */
}
.leaflet-bottom{
    position: absolute; 
    z-index:600 !important;
}

.leaflet-control-layers-list::-webkit-scrollbar {
    width: 8px; /* –¢–æ–≤—â–∏–Ω–∞ —Å–∫—Ä–æ–ª–±–∞—Ä—É */
}

/* –ö–æ–ª—ñ—Ä —Ñ–æ–Ω—É —Å–∫—Ä–æ–ª–±–∞—Ä—É */
.leaflet-control-layers-list::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-radius: 10px;
}

/* –ö–æ–ª—ñ—Ä —Ç–∞ –≤–∏–≥–ª—è–¥ –ø–æ–≤–∑—É–Ω–∫–∞ */
.leaflet-control-layers-list::-webkit-scrollbar-thumb {
    background: #3a3a3a;
    border-radius: 10px;
}

/* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ –∑–º—ñ–Ω—é—î–º–æ –∫–æ–ª—ñ—Ä */
.leaflet-control-layers-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}

input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  background-color: transparent;
  margin: 0;

  font: inherit;
  color: currentColor;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 0.15em;
  transform: translateY(-0.075em);

  display: grid;
  place-content: center;
}
:root {
  --form-control-color: rgb(0, 0, 0);
  --form-control-disabled: #959495;
}
.leaflet-layerstree-header-label{
    display: inline-flex;
    align-items: center;
    gap: 0.5em; /* –í—ñ–¥—Å—Ç—É–ø –º—ñ–∂ —á–µ–∫–±–æ–∫—Å–æ–º —ñ —Ç–µ–∫—Å—Ç–æ–º */
    cursor: pointer;
}
.leaflet-layerstree-header-name b{
    font-size: 1.15em;
}
input[type="checkbox"] {
  appearance: none; /* –ü—Ä–∏–±–∏—Ä–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å—Ç–∏–ª—å */
  display: inline-flex; /* –ó–∞–º—ñ—Å—Ç—å inline-block, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞–≤ ::before */
  align-items: center; /* –í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è */
  justify-content: center;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 0.15em;
  vertical-align: middle; /* –í–∏—Ä—ñ–≤–Ω—é—î –∑ —Ç–µ–∫—Å—Ç–æ–º */
  margin-right: 0.5em; /* –í—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ —Ç–µ–∫—Å—Ç—É */
  position: relative; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è ::before */
}

input[type="checkbox"]::before {
  content: "";
  width: 0.75em;  /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä */
  height: 0.75em;
  clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
  transform: scale(0);
  transform-origin: bottom left;
  transition: 120ms transform ease-in-out;
  box-shadow: inset 1em 1em var(--form-control-color);
  background-color: CanvasText;
}

input[type="checkbox"]:checked::before {
  transform: scale(1);
}

input[type="checkbox"]:focus {
  outline: max(2px, 0.15em) solid currentColor;
  outline-offset: max(2px, 0.15em);
}

input[type="checkbox"]:disabled {
  --form-control-color: var(--form-control-disabled);
  color: var(--form-control-disabled);
  cursor: not-allowed;
}

input[type="radio"] {
  appearance: none;
  width: 1.15em;
  height: 1.15em;
  border: 0.15em solid currentColor;
  border-radius: 50%; /* –†–æ–±–∏—Ç—å –∫–Ω–æ–ø–∫—É –∫—Ä—É–≥–ª–æ—é */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 0.5em;
  position: relative;
  vertical-align: middle;
}

input[type="radio"]::before {
  content: "";
  position: absolute;
  width: 0.65em;
  height: 0.65em;
  background-color: var(--form-control-color);
  border-radius: 50%;
  transform: scale(0);
  transition: 120ms transform ease-in-out;
}

input[type="radio"]:checked::before {
  transform: scale(1);
}

.wind-legend {
  opacity: 0; /* –ü–æ—á–∞—Ç–∫–æ–≤–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ */
  transform: translatex(-20px); /* –õ–µ–≥–∫–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ –∑–Ω–∏–∑—É */
  transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
}

.wind-legend.show {
  opacity: 1;
  transform: translateY(0);
}

.pdfbutton{
                background: #f44336;
                color: white;
                border: none;
                padding: 5px 12px;
                cursor: pointer;
                border-radius: 4px;

            }
            .pdfbutton:hover{
                transform: scale(1.1);
            }

    .filter-panel {
    position: absolute;
    top: 10px;
    right: 260px;
    background: white;
    border-radius: 8px;
    padding: 10px;
    max-width: 300px;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
    z-index: 1000;
    display: none;
    font-family: "Balsamiq Sans", sans-serif;
    font-size: 14px;
  }

  .filter-button2 {
    all: unset;
    position: relative;
    right: -105px;
    font-size: 15px;
    cursor: pointer;
    z-index: 1001;
    
  }
  .filter-button2-close {
    all: unset;
    
    font-size: 15px;
    cursor: pointer;
    
    
  }
  .filter-button2-close-block{
    display: flex;
    justify-content: right;
    margin-bottom: -40px;
  }
  .filter-flex{
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 5px;
  }


        
    </style>
</head>
<body>
    
    <div id="map"></div>

    
    

    <div class="filter-panel" id="filterPanel"> 
        <div class="filter-button2-close-block"><button class="filter-button2-close" onclick="addfiltermenu()" id="filterToggle"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div>
        <h1>–§—ñ–ª—å—Ç—Ä –∫–∞–¥–∞—Å—Ç—Ä—É</h1>
        <h3>–í–ª–∞—Å–Ω—ñ—Å—Ç—å</h3>
        <div class="filter-flex"><input type="checkbox" class="ownership-filter" value="–î–µ—Ä–∂–∞–≤–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å" checked>
            <label > –î–µ—Ä–∂–∞–≤–Ω–∞</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="ownership-filter" value="–ö–æ–º—É–Ω–∞–ª—å–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å" checked>
            <label > –ö–æ–º—É–Ω–∞–ª—å–Ω–∞</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="ownership-filter" value="–ü—Ä–∏–≤–∞—Ç–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å" checked>
            <label > –ü—Ä–∏–≤–∞—Ç–Ω–∞</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="ownership-filter" value="–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ" checked>
            <label > –ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ</label><br></div>
        <h3>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è <a target="_blank" href="https://zakon.rada.gov.ua/laws/show/z1011-10#Text:~:text=II.-,%D0%9A%D0%BB%D0%B0%D1%81%D0%B8%D1%84%D1%96%D0%BA%D0%B0%D1%86%D1%96%D1%8F%20%D0%B2%D0%B8%D0%B4%D1%96%D0%B2%20%D1%86%D1%96%D0%BB%D1%8C%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%B8%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%BD%D1%8F%20%D0%B7%D0%B5%D0%BC%D0%B5%D0%BB%D1%8C,-%D0%9A%D0%BE%D0%B4%20%D0%9A%D0%92%D0%A6%D0%9F%D0%97"><svg xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 -960 960 960" width="15px" fill="#000000"><path d="M480-680q17 0 28.5-11.5T520-720q0-17-11.5-28.5T480-760q-17 0-28.5 11.5T440-720q0 17 11.5 28.5T480-680Zm-40 320h80v-240h-80v240ZM80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Zm126-240h594v-480H160v525l46-45Zm-46 0v-480 480Z"/></svg></a></h3>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –∂–∏—Ç–ª–æ–≤–æ—ó —Ç–∞ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏" checked>
            <label > –ó–µ–º–ª—ñ –∂–∏—Ç–ª–æ–≤–æ—ó —Ç–∞ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏" checked>
            <label > –ó–µ–º–ª—ñ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏</label ><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –ø—Ä–∏—Ä–æ–¥–Ω–æ-–∑–∞–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ –ø—Ä–∏—Ä–æ–¥–Ω–æ-–∑–∞–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –æ–∑–¥–æ—Ä–æ–≤—á–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ –æ–∑–¥–æ—Ä–æ–≤—á–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ —Ä–µ–∫—Ä–µ–∞—Ü—ñ–π–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ —Ä–µ–∫—Ä–µ–∞—Ü—ñ–π–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ —ñ—Å—Ç–æ—Ä–∏–∫–æ-–∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ —ñ—Å—Ç–æ—Ä–∏–∫–æ-–∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –ª—ñ—Å–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ –ª—ñ—Å–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –≤–æ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É" checked>
            <label > –ó–µ–º–ª—ñ –≤–æ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É, –∑–≤'—è–∑–∫—É, –µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏, –æ–±–æ—Ä–æ–Ω–∏ —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É, –∑–≤'—è–∑–∫—É, –µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏, –æ–±–æ—Ä–æ–Ω–∏ —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label><br></div>
        <div class="filter-flex"><input type="checkbox" class="category-filter" value="–ó–µ–º–ª—ñ –∑–∞–ø–∞—Å—É, —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è" checked>
            <label > –ó–µ–º–ª—ñ –∑–∞–ø–∞—Å—É, —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è</label><br></div>
    </div>

    <div id="legend" style="
        position: absolute; 
        bottom: 30px; 
        left: 10px; 
        background: white; 
        padding: 10px; 
        border-radius: 5px; 
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
        font-family: Arial, sans-serif;
        font-size: 14px;
        display: none; /* —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ */
        z-index: 1000;
        ">
        <h4>–õ–µ–≥–µ–Ω–¥–∞ –∫–∞–¥–∞—Å—Ç—Ä—É</h4>
        <div><span style="background: rgba(255,0,0,0.3); width: 20px; height: 10px; display: inline-block; margin-right: 5px;"></span>–ö–æ–º—É–Ω–∞–ª—å–Ω–∞ / –î–µ—Ä–∂–∞–≤–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å</div>
        <div><span style="background: rgba(0, 238, 255, 0.5); width: 20px; height: 10px; display: inline-block; margin-right: 5px;"></span>–ñ–∏—Ç–ª–æ–≤–∞ —Ç–∞ –≥—Ä–æ–º–∞–¥—Å—å–∫–∞ –∑–∞–±—É–¥–æ–≤–∞</div>
        <div><span style="background: rgba(0,0,0,0.1); width: 20px; height: 10px; display: inline-block; margin-right: 5px;"></span>–Ü–Ω—à—ñ –¥—ñ–ª—è–Ω–∫–∏</div>
        </div>

    <div id="pdfViewerContainer" style="
    position: absolute;
    top: 0;
    right: 0;
    width: 850px;
    height: 97.5%;
    overflow-y: auto;
    background: white;
    border-left: 2px solid #888;
    padding: 10px;
    z-index: 1000;
    display: none;
">
   <!-- –¢–µ–≥ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ PDF --> <!-- –í–º—ñ—Å—Ç PDF   <div class="filter-button" id="filterToggle">–§—ñ–ª—å—Ç—Ä–∏ ‚ñæ</div>-->
</div>

<!-- –§—ñ–∫—Å–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è (–ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) -->
<button id="closePDFBtn" onclick="closePDF()" style="
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1100;
    background: #f44336;
    color: white;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
    display: none; /* –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
">–ó–∞–∫—Ä–∏—Ç–∏</button>

    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.5.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iso8601-js-period@0.2.1/iso8601.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/esri-leaflet.js"></script>
    
    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/MarkerCluster.css" />
    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/MarkerCluster.Default.css" />
<!--
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://jjimenezshaw.github.io/Leaflet.Control.Layers.Tree/L.Control.Layers.Tree.js"></script>
-->
    
    
    <!-- JavaScript –¥–ª—è MarkerCluster -->
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet.markercluster.js"></script>

    <!--line-->
    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet-measure.css" />
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet-measure.js"></script>
    <!--tiffff-->
    <script src="https://cdn.jsdelivr.net/npm/georaster@1.6.0/dist/georaster.browser.bundle.min.js"></script>
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/georaster-layer-for-leaflet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rainbowvis.js@1.1.1/rainbowvis.js"></script>
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/geoblaze.web.min.js"></script>
    <!--derevo-->
    <link rel="stylesheet" href="L.Control.Layers.Tree.css">
    <script src="L.Control.Layers.Tree.js"></script>

    <!-- draw tool-------->
    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet-geoman.css" />
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/leaflet-geoman.min.js"></script>
    <!--poligon pattern-->
<!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∏–ª—é –ø–ª–∞–≥—ñ–Ω–∞ Leaflet.Pattern -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-pattern/0.0.6/leaflet.pattern.min.css" />

    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∞–º–æ–≥–æ –ø–ª–∞–≥—ñ–Ω–∞ Leaflet.Pattern -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-pattern/0.0.6/leaflet.pattern.min.js"></script>
     <!-- –≥–ª–æ–±—É—Å -->
    <script src="https://unpkg.com/leaflet-globes"></script>
    <!-- –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–æ—à—É–∫ -->
    <link rel="stylesheet" href="https://mark-000.github.io/pl-power-vis-map.github.io/libs/Control.Geocoder.css" />
    <script src="https://mark-000.github.io/pl-power-vis-map.github.io/libs/Control.Geocoder.js"></script>

<!-- ‚úÖ CSS –¥–ª—è –≥–µ–æ–∫–æ–¥–µ—Ä–∞ -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>


    <script src="https://unpkg.com/leaflet.vectorgrid/dist/Leaflet.VectorGrid.bundled.js"></script>

     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-storage.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyAQpI0dCWKbXACbnNi445Hro26SzrlsGdU",
            authDomain: "my-map-pj-54751.firebaseapp.com",
            projectId: "my-map-pj-54751",
            storageBucket: "my-map-pj-54751.firebasestorage.app",
            messagingSenderId: "349429907738",
            appId: "1:349429907738:web:8a6d42bfeaf8eb0b612ca3",
            measurementId: "G-T4XGCQ6PDH"
        };
    
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app); // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ auth –æ–¥–∏–Ω —Ä–∞–∑
    
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                const currentUrl = window.location.href;
                const loginUrl = `https://mark-000.github.io/pl-power-vis-map.github.io/login.html?redirect=${encodeURIComponent(currentUrl)}`;
                window.location.href = loginUrl;
            } else {
                // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ
                const storage = getStorage(app); // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ firebaseApp –∑ —É–∂–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º auth
                try {
                    const url1 = await getDownloadURL(ref(storage, 'ourkadnum-ur-all.geojson'));
                    
    
                    const data1 = await fetch(url1).then(r => r.json());
                    
    
                    window.loadedGeojsons = { data1}; // –ø–µ—Ä–µ–¥–∞—î–º–æ –¥–∞–Ω—ñ –¥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É
                    window.initMap(); // –≤–∏–∫–ª–∏–∫–∞—î–º–æ –ø–æ–±—É–¥–æ–≤—É –∫–∞—Ä—Ç–∏
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤:", error);
                }
            }
        });
    </script>






    <script>
    
      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏
    var map = L.map('map', {
        zoomControl: false, // –•–æ–≤–∞—î–º–æ –∫–æ–Ω—Ç—Ä–æ–ª –∑—É–º—É, —â–æ–± –Ω–µ –∑–∞–≤–∞–∂–∞–≤ –∞–Ω—ñ–º–∞—Ü—ñ—ó
        attributionControl: false, // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∞—Ç—Ä–∏–±—É—Ü—ñ—é
        center: [20, 0], // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∏–≥–ª—è–¥ –Ω–∞ –≥–ª–æ–±—É—Å
        zoom: 2,
        globeView: true // –ê–∫—Ç–∏–≤—É—î–º–æ —Ä–µ–∂–∏–º –≥–ª–æ–±—É—Å–∞
    });
    
    var osmLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 22
        }).addTo(map);




        let loadedPDF = null; // –≥–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞

    const pdfUrl = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/ilovepdf_merged.pdf';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
        loadedPDF = pdf;
    }).catch(error => {
        console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF:", error);
    });

    function openPDF(kadastrNumber) {
    const container = document.getElementById('pdfViewerContainer');
    container.innerHTML = ''; // –æ—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö canvas
    container.style.display = 'block';
    document.getElementById('closePDFBtn').style.display = 'block';

    if (!loadedPDF) {
        alert("PDF —â–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥.");
        return;
    }

    const pdf = loadedPDF;
    let foundPageIndex = null;

    const renderAllPages = async () => {
        const dpiScale = window.devicePixelRatio || 1;

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const scale = dpiScale * 1.4;
            const viewport = page.getViewport({ scale });

            const canvas = document.createElement('canvas');
            canvas.id = `pdf-page-${i}`;
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            canvas.style.width = `${viewport.width / dpiScale}px`;
            canvas.style.height = `${viewport.height / dpiScale}px`;

            await page.render({ canvasContext: context, viewport }).promise;

            const textContent = await page.getTextContent();
            const text = textContent.items.map(item => item.str).join(' ');
            if (text.includes(kadastrNumber) && foundPageIndex === null) {
                foundPageIndex = i;
            }

            container.appendChild(canvas);
        }

        if (foundPageIndex !== null) {
            const targetCanvas = document.getElementById(`pdf-page-${foundPageIndex}`);
            targetCanvas.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            alert("–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
        }
    };

    renderAllPages();
}
function closePDF() {
    // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ PDF —ñ –∫–Ω–æ–ø–∫—É
    document.getElementById('pdfViewerContainer').style.display = 'none';
    document.getElementById('closePDFBtn').style.display = 'none';
}























    
    
    window.initMap = function () {
        const { data1} = window.loadedGeojsons;
    
        

        // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó - –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –≥–ª–æ–±—É—Å–∞
        setTimeout(() => {
            map.flyTo([49.840853, 25.547606], 7, { // –ó–∞–¥–∞—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ –∑—É–º
                animate: true,
                duration: 3 // –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∞–Ω—ñ–º–∞—Ü—ñ—ó
            });
        });

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–ª–∏—Ç–æ–∫ –∫–∞—Ä—Ç–∏ (OpenStreetMap)
        var WhiteLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
                maxZoom: 22
            });

            

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–ª–∏—Ç–æ–∫ Google Maps
            var googleLayer = L.tileLayer('http://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {
                attribution: 'Google Maps',
                maxZoom: 22
            });
            //topo map
            var topoLayer = L.tileLayer('https://tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'opentopomap',
                maxZoom: 22
            });








const parcelLayerGroup = L.layerGroup().addTo(map);

// –ì–µ–æ–∫–æ–¥–µ—Ä (–±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—É)
const geocoder = L.Control.Geocoder.nominatim();

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞
function isValidCadnum(input) {
  return /^\d{10}:\d{2}:\d{3}:\d{4}$/.test(input.trim());
}

// –ü–æ—à—É–∫ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ—ó –¥—ñ–ª—è–Ω–∫–∏
async function findParcel(cadnum) {
  try {
    const res = await fetch(`https://kadastr.live/api/parcels/${cadnum}/?format=json`);
    if (!res.ok) throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥—ñ–ª—è–Ω–∫—É");
    const data = await res.json();
    const details = data.details || data;
    const geojson = L.geoJSON(data.geometry, {
      style: { color: '#ff6600', weight: 2, fillOpacity: 0.3 }
    });

    const center = geojson.getBounds().getCenter();

    const removeButton = document.createElement('button');
    removeButton.innerHTML = '–í–∏–¥–∞–ª–∏—Ç–∏';
    removeButton.style.background = '#f44336';
    removeButton.style.color = 'white';
    removeButton.style.border = 'none';
    removeButton.style.padding = '5px 12px';
    removeButton.style.cursor = 'pointer';
    removeButton.style.borderRadius = '4px';
    removeButton.style.float = 'right';


    removeButton.onclick = () => {
      parcelLayerGroup.removeLayer(geojson);
      map.closePopup();
    };

    const popupDiv = document.createElement('div');
    popupDiv.style.fontFamily = 'Arial, sans-serif';
    popupDiv.style.fontSize = '14px';

    popupDiv.innerHTML = `
      <h4 style="margin: 5px 0; font-size: 16px; color: #d9534f;">${cadnum}</h4>
      <div><b>–í–ª–∞—Å–Ω—ñ—Å—Ç—å:</b> ${details.ownership || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
      <div><b>–ü–ª–æ—â–∞:</b> ${details.area || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"} ${details.unit_area || ''}</div>
      <div><b>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</b> ${details.use || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
      <div><b>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</b> ${details.purpose || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"} (${details.purpose_code || ''})</div>
      <div><b>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</b> ${details.category || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
      <div><b>–ù–ì–û:</b> ${details.valuation_value || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
      <div>üîó<a href="https://e.land.gov.ua/back/cadaster/?cad_num=${cadnum}" target="_blank" style="color: blue; text-decoration: underline;"> –î–µ—Ç–∞–ª—ñ –≤ –î–ó–ö</a></div>
            
      
    `;

    popupDiv.appendChild(removeButton);

    geojson.bindPopup(() => popupDiv);

    geojson.addTo(parcelLayerGroup);
    map.setView(center, 16);
    geojson.openPopup(center);
  } catch (e) {
    alert("–ü–æ–º–∏–ª–∫–∞: " + e.message);
  }
}

// UI –ø–æ—à—É–∫—É
const input = document.createElement('input');
input.type = 'text';
input.placeholder = '–ê–¥—Ä–µ—Å–∞ –∞–±–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä';
input.style.padding = '5px';
input.style.width = '250px';
input.style.border = '1px solid #ccc';
input.style.backgroundColor = 'none';
input.style.border = 'none';
input.style.fontSize = '15px';
input.style.borderRight = '1.5px solid grey';

const searchButton = document.createElement('button');
searchButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#2b2b2b"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q146 0 255.5 91.5T872-559h-82q-19-73-68.5-130.5T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h80v120h-40L168-552q-3 18-5.5 36t-2.5 36q0 131 92 225t228 95v80Zm364-20L716-228q-21 12-45 20t-51 8q-75 0-127.5-52.5T440-380q0-75 52.5-127.5T620-560q75 0 127.5 52.5T800-380q0 27-8 51t-20 45l128 128-56 56ZM620-280q42 0 71-29t29-71q0-42-29-71t-71-29q-42 0-71 29t-29 71q0 42 29 71t71 29Z"/></svg>';

searchButton.style.padding = '5px';
searchButton.style.backgroundColor = 'white';
searchButton.style.border = 'none';
//searchButton.style.borderLeft = '1.5px solid grey';


const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
container.style.background = 'white';

container.style.display = 'flex';
container.style.alignItems = 'center';
container.appendChild(input);
container.appendChild(searchButton);

// –î–æ–¥–∞—î–º–æ –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –∫–∞—Ä—Ç—É
L.Control.SearchUnified = L.Control.extend({
  onAdd: () => container,
  onRemove: () => {}
});

L.control.searchUnified = opts => new L.Control.SearchUnified(opts);
L.control.searchUnified({ position: 'topleft' }).addTo(map);

// –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ—à—É–∫—É –∑ async/await
async function handleSearch() {
  const query = input.value.trim();
  if (!query) return;

  if (isValidCadnum(query)) {
    await findParcel(query);
  } else {
    try {
      const results = await geocoder.geocode(query);
      console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≥–µ–æ–∫–æ–¥—É:", results);
      if (results.length > 0) {
        const result = results[0];
        map.setView(result.center, 15);
        L.popup()
          .setLatLng(result.center)
          .setContent(`<b>${result.name}</b>`)
          .openOn(map);
      } else {
        alert("–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
      }
    } catch (e) {
      alert("–ü–æ–º–∏–ª–∫–∞ –≥–µ–æ–∫–æ–¥—É: " + e.message);
    }
  }
}

// –ü–æ–¥—ñ—ó
searchButton.onclick = handleSearch;
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleSearch();
  }
});





























        // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è OpenStreetMap
        //  osmLayer.addTo(map);
    var coordDiv = L.control({ position: 'bottomright' });

    coordDiv.onAdd = function () {
        var div = L.DomUtil.create('div', 'coordinate-display');
        div.style.padding = '5px';
        div.style.background = 'white';
        div.style.opacity = '0.8';
        div.style.cursor = 'pointer'; // –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—å –¥–ª—è –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞ –º–∏—à—ñ
        div.innerHTML = "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:";
        
        // –î–æ–¥–∞—î–º–æ –ø–æ–¥—ñ—é –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø—Ä–∏ –∫–ª—ñ–∫—É
        div.addEventListener('click', function () {
            const text = div.innerText.replace('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                div.innerHTML = `‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ ${text}`;
                setTimeout(updateCenterCoordinates, 1500); // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–∑–∞–¥ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥–∏
            }).catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:", err));
        });

        return div;
    };

    coordDiv.addTo(map);

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ü–µ–Ω—Ç—Ä—É –∫–∞—Ä—Ç–∏
    function updateCenterCoordinates() {
        var center = map.getCenter();
        document.querySelector('.coordinate-display').innerHTML = 
            `${center.lat.toFixed(6)}, ${center.lng.toFixed(6)}`;
    }

    // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø—Ä–∏ —Ä—É—Å—ñ –∫–∞—Ä—Ç–∏
    map.on('moveend', updateCenterCoordinates);

    // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    updateCenterCoordinates();

        
    //-----------------------------–º–∞–ª—é–≤–∞–Ω–Ω—è - –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è--------------------------------------
            var measureControl = new L.Control.Measure({
                position: "topleft",
                primaryLengthUnit: "meters",
                secondaryLengthUnit: "kilometers", // –û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
                primaryAreaUnit: "hectares",
                secondaryAreaUnit: "sqmeters",
                showMeasurements: true, // –ü–æ–∫–∞–∑—É—î –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ–π
                captureZIndex: 10000,
                measureControlTitle: "–í–∏–º—ñ—Ä—è—Ç–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å",
                activeColor: '#ff0000',  // –ö–æ–ª—ñ—Ä –ª—ñ–Ω—ñ—ó –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
                completedColor: '#0000ff'
                
            });

            map.addControl(measureControl);

            
            // –î–æ–¥–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –Ω–∞ –∫–∞—Ä—Ç—É
            map.pm.addControls({
                position: 'bottomright', // –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ
                drawCircle: true,
                drawRectangle: false,
                drawPolygon: true, 
                drawMarker: false, // –í–∏–º–∫–Ω—É—Ç–∏ —Ç–æ—á–∫–∏
                drawCircleMarker: false, // –í–∏–º–∫–Ω—É—Ç–∏ –∫—Ä—É–≥–ª—ñ –º–∞—Ä–∫–µ—Ä–∏
                drawText: true, // –í–∏–º–∫–Ω—É—Ç–∏ —Ç–µ–∫—Å—Ç
                measureControl: true,
                editMode: false, // –í–∏–º–∏–∫–∞—î —Ä–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
                cutPolygon: false,
                rotateMode: false,
            });

            // 4. –í–∫–ª—é—á–∞—î–º–æ —Ä–µ–∂–∏–º –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏/–ø–ª–æ—â—ñ
            map.pm.setGlobalOptions({
                measureControl: true,  // –î–æ–¥–∞—î –∫–Ω–æ–ø–∫—É –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
                allowSelfIntersection: true, // –í–∏–º–∏–∫–∞—î –ø–µ—Ä–µ—Ç–∏–Ω —Å–∞–º–∏—Ö —Å–µ–±–µ
                cutPolygon: false, // –í–∏–º–∏–∫–∞—î –≤–∏—Ä—ñ–∑–∞–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
                editMode: false,
                rotateMode: false,
                snappable: false,
            });

            map.pm.setPathOptions({
                color: 'red',        // –ö–æ–ª—ñ—Ä –ª—ñ–Ω—ñ–π
                fillColor: 'red',   // –ö–æ–ª—ñ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
                fillOpacity: 0,    // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤
                weight: 2           // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
            });

            let distanceTooltip;
        
            map.on('pm:drawstart', function (e) {
                if (e.workingLayer instanceof L.Polyline) {
                    let totalDistance = 0;
                    let lastLatLng = null;

                    e.workingLayer.on('pm:vertexadded', function (event) {
                        let latlngs = e.workingLayer.getLatLngs();
                        let currentLatLng = latlngs[latlngs.length - 1]; 

                        if (lastLatLng !== null) {
                            totalDistance += lastLatLng.distanceTo(currentLatLng);
                        }
                        lastLatLng = currentLatLng;

                        if (distanceTooltip) {
                            map.removeLayer(distanceTooltip);
                        }

                        distanceTooltip = L.tooltip({
                            permanent: false,
                            direction: 'top',
                            className: 'distance-tooltip'
                        })
                            .setLatLng(currentLatLng)
                            .setContent(`${totalDistance.toFixed(2)} –º`)
                            .addTo(map);
                    });

                    map.once('pm:drawend', function () {
                        if (distanceTooltip) {
                            map.removeLayer(distanceTooltip);
                        }
                    });
                }
            });




    map.on('pm:drawstart', function (e) {
        if (e.workingLayer instanceof L.Circle) {
            let centerLatLng = null;

            // –°–ª—É—Ö–∞—á –ø–æ–¥—ñ—ó –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É –∫–æ–ª–∞
            map.on('click', function setCenter(event) {
                centerLatLng = event.latlng; // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ü–µ–Ω—Ç—Ä –∫–æ–ª–∞ –Ω–∞ –ø–µ—Ä—à–µ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç—É
                map.off('click', setCenter); // –í–∏–º–∏–∫–∞—î–º–æ —Å–ª—É—Ö–∞—á–∞ –ø—ñ—Å–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É

                // –û–Ω–æ–≤–ª—é—î–º–æ —Ç—É–ª—Ç—ñ–ø –ø—ñ–¥ —á–∞—Å –º–∞–ª—é–≤–∞–Ω–Ω—è
                let moveListener = function (event) {
                    let currentLatLng = event.latlng;
                    let radius = centerLatLng.distanceTo(currentLatLng); // –í—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É –∫–æ–ª–∞ –¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó —Ç–æ—á–∫–∏

                    // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Ç—É–ª—Ç—ñ–ø
                    if (distanceTooltip) {
                        map.removeLayer(distanceTooltip);
                    }

                    // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ç—É–ª—Ç—ñ–ø –±—ñ–ª—è –∫—É—Ä—Å–æ—Ä–∞
                    distanceTooltip = L.tooltip({
                        permanent: false,
                        direction: 'top',
                        className: 'distance-tooltip'
                    })
                        .setLatLng(currentLatLng) // –ü–æ–∑–∏—Ü—ñ—è —Ç—É–ª—Ç—ñ–ø–∞ –±—ñ–ª—è –∫—É—Ä—Å–æ—Ä–∞
                        .setContent(`–†–∞–¥—ñ—É—Å: ${radius.toFixed(2)} –º`)
                        .addTo(map);
                };

                map.on('mousemove', moveListener); // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á–∞ –¥–ª—è –ø–æ–¥—ñ—ó mousemove –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü–µ–Ω—Ç—Ä—É

                // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –º–∞–ª—é–≤–∞–Ω–Ω—è –∫–æ–ª–∞
                map.once('pm:drawend', function () { // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `once` –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–¥—ñ—é —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑
                    map.removeLayer(distanceTooltip);
                    map.off('mousemove', moveListener); // –í–∏–º–∏–∫–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç—É–ª—Ç—ñ–ø–∞ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –º–∞–ª—é–≤–∞–Ω–Ω—è
                });
            });
        }
    });

    var selectedPolygon = null; // –¢—É—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤–∏–±—Ä–∞–Ω–∏–π –ø–æ–ª—ñ–≥–æ–Ω

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –ø–æ–ª—ñ–≥–æ–Ω –¥–ª—è –≤–∏–±–æ—Ä—É
    map.on('pm:create', function (e) {
        e.layer.on('click', function () {
            if (selectedPolygon) {
                selectedPolygon.setStyle({ color: 'red' }); // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–ª—ñ—Ä
            }
            selectedPolygon = this;
            selectedPolygon.setStyle({ color: 'blue' }); // –í–∏–¥—ñ–ª—è—î–º–æ –≤–∏–±—Ä–∞–Ω–∏–π –ø–æ–ª—ñ–≥–æ–Ω
        });
    });

    // –§—É–Ω–∫—Ü—ñ—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤–∏–±—Ä–∞–Ω–æ–≥–æ –ø–æ–ª—ñ–≥–æ–Ω—É
    function exportSelectedGeoJSON() {
        if (!selectedPolygon) {
            alert("–í–∏–±–µ—Ä—ñ—Ç—å –ø–æ–ª—ñ–≥–æ–Ω, –∫–ª—ñ–∫–Ω—É–≤—à–∏ –Ω–∞ –Ω—å–æ–≥–æ!");
            return;
        }

        // –û—Ç—Ä–∏–º—É—î–º–æ GeoJSON
        var geojsonFeature = selectedPolygon.toGeoJSON();
        var geojsonString = JSON.stringify(geojsonFeature, null, 2);

        // –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
        var blob = new Blob([geojsonString], { type: "application/json" });
        var link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "selected_polygon.geojson";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—ñ–≥–æ–Ω—É
    var downloadButton = L.control({ position: "bottomright" });

    downloadButton.onAdd = function (map) {
        var div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
        div.innerHTML = '<button style="background:#fff;border:1px solid #ccc;padding:5px 5px;cursor:pointer;">‚¨áÔ∏è</button>';
        div.onclick = exportSelectedGeoJSON;
        return div;
    };

    // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –Ω–∞ –∫–∞—Ä—Ç—É


    downloadButton.addTo(map);

    /*L.Control.geocoder({
        position: "topleft",
        defaultMarkGeocode: false
    }).on('markgeocode', function(e) {
        map.setView(e.geocode.center, 15);
    }).addTo(map);*/




    //-----------------------------–±—É–¥—É–≤–∞–Ω–Ω—è —à–∞—Ä—ñ–≤--------------------------------------    


    
                    //-------------------------------------------------------------------
            var geojsonUrlBorder = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/Ukraine_Border.geojson';
            map.createPane('borderPane');
                //map.getPane('borderPane').style.zIndex = 400;
                    fetch(geojsonUrlBorder)
                        .then(response => response.json())
                        .then(borderGeojsonData => {
                            borderLayer = L.geoJSON(borderGeojsonData, {
                                pane: 'borderPane',
                                style: {
                                    color: '#595857', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                                    weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                                    fillOpacity: 0
                                },
                                interactive: false
                            });
    //-------------------------------------------------------------------
            
                                                                                            //map.getPane('borderPane').style.zIndex = 400;
            var waterPolyLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/water_poly_ramsar/{z}/{x}/{y}.png');
            var dzkPzfLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__pzf/{z}/{x}/{y}.png');
            var cadastrLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/parcels/{z}/{x}/{y}.png');
            var oblastLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_oblast/{z}/{x}/{y}.png');
            var raionLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_rayon/{z}/{x}/{y}.png');
            var otgLayer = L.tileLayer('https://cdn.kadastr.live/tiles/raster/styles/dzk__atu_terhromad__line/{z}/{x}/{y}.png');

            var geojsonUrlemerald = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/amerald_zahid.geojson';
            fetch(geojsonUrlemerald)
                .then(response => response.json())
                .then(borderGeojsonData => {
                    emeraldLayer = L.geoJSON(borderGeojsonData, {
                        style: {
                            color: '#3b8f51', // –ö–æ–ª—ñ—Ä —à–∞—Ä—É
                            weight: 1, // –¢–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π
                            fillOpacity: 0.3
                        },
                        interactive: false,
                        zIndex: -999  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ zIndex, —â–æ–± —à–∞—Ä –±—É–≤ –ø—ñ–¥ —ñ–Ω—à–∏–º–∏
                    });

                    

    //----------------------------------------------------------------tifs-----------------------------------------------------------------


            
                

            var geojsonUrlAnimal = 'https://mark-000.github.io/pl-power-vis-map.github.io/UAmap/animalss.geojson';
            fetch(geojsonUrlAnimal)
                .then(response => response.json())
                .then(projektyGeojsonData => {
                    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –¥–∞–Ω—ñ: —Ç—ñ–ª—å–∫–∏ –¥–µ –∫–ª–∞—Å = 'Aves' –∞–±–æ —Ä—è–¥ = 'Chiroptera'
                    let filteredData = {
                        type: "FeatureCollection",
                        features: projektyGeojsonData.features.filter(feature => 
                            feature.properties.class === "Aves" || feature.properties.family === "Vespertilionidae" || feature.properties.family === "Rhinolophidae"
                        )
                    };
                    // –°—Ç–≤–æ—Ä—é—î–º–æ —à–∞—Ä –∑ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏
                    animalLayer = L.geoJSON(filteredData, {
                        pointToLayer: function(feature, latlng) {
                            return L.circleMarker(latlng, {
                                radius: 4, 
                                fillColor: "red",
                                color: "black",
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 1
                            });
                        },
                        onEachFeature: function(feature, layer) {
                            layer.bindPopup(`
                                <b>–ù–∞–∑–≤–∞:</b> ${feature.properties.scientificName || 'Unknown'}<br>
                                <b>–ö–ª–∞—Å:</b> ${feature.properties.class || 'Unknown'}<br>
                                <b>–†—è–¥:</b> ${feature.properties.order || 'Unknown'}<br>
                                <b>–î–∞—Ç–∞:</b> ${feature.properties.eventDate || 'Unknown'}
                            `);
                        }
                    })

            


    // --------------------------------- points to mark –Ω–∞—à—ñ –ª–æ–∫–∞—Ü—ñ—ó ------------------------------------
    var circles = {};
    function toggleCircles(latlng) {
        var key = latlng.toString(); // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –¥–ª—è —Ç–æ—á–∫–∏

        if (circles[key]) {
            // –Ø–∫—â–æ –∫–æ–ª–∞ –≤–∂–µ —î ‚Äî –≤–∏–¥–∞–ª—è—î–º–æ
            circles[key].forEach(circle => map.removeLayer(circle));
            delete circles[key];
        } else {
            // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ –∫–æ–ª–∞ (–ù–ï—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ)
            var circle700 = L.circle(latlng, { radius: 700, color: '#02fae1', fillOpacity: 0.1, interactive: false }).addTo(map);
            var circle150 = L.circle(latlng, { radius: 150, color: '#02fae1', fillOpacity: 0.1, interactive: false }).addTo(map);
            circles[key] = [circle700, circle150];
        }
    }

    






let activeOwnershipFilters = ["–î–µ—Ä–∂–∞–≤–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å", "–ö–æ–º—É–Ω–∞–ª—å–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å", "–ü—Ä–∏–≤–∞—Ç–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å", "–ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ"];
let activeCategoryFilters = ["–ó–µ–º–ª—ñ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ –∂–∏—Ç–ª–æ–≤–æ—ó —Ç–∞ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏","–ó–µ–º–ª—ñ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏","–ó–µ–º–ª—ñ –ø—Ä–∏—Ä–æ–¥–Ω–æ-–∑–∞–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è",
"–ó–µ–º–ª—ñ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ –æ–∑–¥–æ—Ä–æ–≤—á–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ —Ä–µ–∫—Ä–µ–∞—Ü—ñ–π–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ —ñ—Å—Ç–æ—Ä–∏–∫–æ-–∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ –ª—ñ—Å–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ –≤–æ–¥–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É","–ó–µ–º–ª—ñ –ø—Ä–æ–º–∏—Å–ª–æ–≤–æ—Å—Ç—ñ, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É, –∑–≤'—è–∑–∫—É, –µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏, –æ–±–æ—Ä–æ–Ω–∏ —Ç–∞ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è","–ó–µ–º–ª—ñ –∑–∞–ø–∞—Å—É, —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ñ–æ–Ω–¥—É —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è"]
let hoveredId = null;
let vectorTileLayer = null;

// –§—É–Ω–∫—Ü—ñ—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ñ—ñ–ª—å—Ç—Ä–∞
function getParcelStyle(properties, zoom) {
  let fillColor = "rgba(0,0,0,0.1)";
  let color = "rgb(0,0,0)";

  if (activeOwnershipFilters.includes(properties.ownership) && activeCategoryFilters.includes(properties.category) ) {
    if (
      properties.ownership === "–ö–æ–º—É–Ω–∞–ª—å–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å" ||
      properties.ownership === "–î–µ—Ä–∂–∞–≤–Ω–∞ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å"
    ) {
      fillColor = "rgba(255,0,0,0.3)";
      color = "#d11d1d";
    }

    const bluePurposeCodes = [
      "02.01", "02.02", "02.03", "02.04", "02.05", "02.06", "02.07", "02.08",
      "02.09", "02.10", "03.01", "03.02", "03.03", "03.04", "03.05", "03.06", 
      "03.15", "07.01", "07.03", "07.04", "07.05"
    ];

    if (
      bluePurposeCodes.includes(properties.purpose_code) ||
      (properties.category && properties.category.includes("–ó–µ–º–ª—ñ –∂–∏—Ç–ª–æ–≤–æ—ó —Ç–∞ –≥—Ä–æ–º–∞–¥—Å—å–∫–æ—ó –∑–∞–±—É–¥–æ–≤–∏"))
    ) {
      fillColor = "rgba(0, 238, 255, 0.51)";
      color = "rgb(0, 238, 255)";
    }
  } else {
    // –Ø–∫—â–æ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å –Ω–µ –≤—Ö–æ–¥–∏—Ç—å –¥–æ –∞–∫—Ç–∏–≤–Ω–∏—Ö ‚Äî –ø—Ä–æ–∑–æ—Ä–∏–π (–Ω–µ–≤–∏–¥–∏–º–∏–π)
    return {
      fill: false,
      stroke: false,
      weight: 0
    };
  }

  return {
    fill: true,
    fillColor: fillColor,
    fillOpacity: 0.3,
    color: color,
    weight: 0.5
  };
}

// –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞—Ä—É –∑ –∞–∫—Ç—É–∞–ª—å–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏
function createVectorTileLayer() {
  return L.vectorGrid.protobuf(
    "https://cdn.kadastr.live/tiles/maps/kadastr/{z}/{x}/{y}.pbf?version=0.6.5",
    {
      vectorTileLayerStyles: {
        land_polygons: function(properties, zoom) {
          return getParcelStyle(properties, zoom);
        }
      },
      minZoom: 13,
      maxNativeZoom: 16,
      interactive: true,
      getFeatureId: f => f.properties.cadnum
    }
  );
}

// –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–æ —à–∞—Ä—É
function attachVectorLayerEvents(layer) {
  layer.on('click', async function(e) {
    const p = e.layer.properties;
    const cadnum = p.cadnum;

    if (!cadnum) {
      L.popup()
        .setLatLng(e.latlng)
        .setContent(`<div><strong>–ù–µ–º–∞—î –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞</strong></div>`)
        .openOn(map);
      return;
    }

    try {
      const response = await fetch(`https://kadastr.live/api/parcels/${cadnum}/?format=json`);
      const data = await response.json();

      const popupContent = `
        <div style="font-family: Arial, sans-serif; font-size: 14px;">
          <h4 style="margin: 5px 0; font-size: 16px; color: #d9534f;">${cadnum}</h4>
          <div><b>–í–ª–∞—Å–Ω—ñ—Å—Ç—å:</b> ${data.ownership || p.ownership || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
          <div><b>–ü–ª–æ—â–∞:</b> ${data.area || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"} ${data.unit_area || ""}</div>
          <div><b>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</b> ${data.use || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
          <div><b>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</b> ${data.purpose || p.purpose || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"} (${data.purpose_code || ""})</div>
          <div><b>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</b> ${data.category || p.category || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
          <div><b>–ù–ì–û:</b> ${data.valuation_value || "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö"}</div>
          <div>üîó<a href="https://e.land.gov.ua/back/cadaster/?cad_num=${cadnum}" target="_blank">–î–µ—Ç–∞–ª—ñ –≤ –î–ó–ö</a></div>
        </div>
      `;

      L.popup()
        .setLatLng(e.latlng)
        .setContent(popupContent)
        .openOn(map);
    } catch (err) {
      L.popup()
        .setLatLng(e.latlng)
        .setContent("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö")
        .openOn(map);
    }
  });

  layer.on('mouseover', function(e) {
    const id = layer.options.getFeatureId(e.layer);
    if (id !== null) {
      hoveredId = id;
      layer.setFeatureStyle(id, {
        fill: true,
        fillColor: 'yellow',
        fillOpacity: 0.2,
        color: 'orange',
        weight: 2
      });
    }
  });

  layer.on('mouseout', function(e) {
    if (hoveredId !== null) {
      layer.resetFeatureStyle(hoveredId);
      hoveredId = null;
    }
  });
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —à–∞—Ä—É —ñ –ø–æ–¥—ñ–π
vectorTileLayer = createVectorTileLayer()//.addTo(map);
attachVectorLayerEvents(vectorTileLayer);

// –õ–æ–≥—ñ–∫–∞ –∫–Ω–æ–ø–∫–∏ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤

                window.addfiltermenu = function () {
    const panel = document.getElementById("filterPanel");
    panel.style.display = panel.style.display === "none" ? "block" : "none";
};




function updateFilters() {
    // –û–Ω–æ–≤–ª—é—î–º–æ –æ–±–∏–¥–≤–∞ –º–∞—Å–∏–≤–∏
    activeOwnershipFilters = Array.from(document.querySelectorAll(".ownership-filter:checked"))
        .map(cb => cb.value);

    activeCategoryFilters = Array.from(document.querySelectorAll(".category-filter:checked"))
        .map(cb => cb.value);

    // –ü–µ—Ä–µ–º–∞–ª—é–≤–∞—Ç–∏ —à–∞—Ä
    if (vectorTileLayer) {
        vectorTileLayer.redraw();
    }
}

// –ù–∞–≤—ñ—à—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è ownership
document.querySelectorAll(".ownership-filter").forEach(cb => {
    cb.addEventListener("change", updateFilters);
});

// –ù–∞–≤—ñ—à—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è category
document.querySelectorAll(".category-filter").forEach(cb => {
    cb.addEventListener("change", updateFilters);
});
















var small_14_01 = L.geoJSON(data1, {
            style: function(feature) {
                // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–ª—å–æ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è "–°–µ—Ä–≤—ñ—Ç—É—Ç"
                var fillColor;
                if (feature.properties['–°–µ—Ä–≤—ñ—Ç—É—Ç'] === true) {
                    fillColor = "#5867c4"; // –°–∏–Ω—ñ–π –¥–ª—è —Å–µ—Ä–≤—ñ—Ç—É—Ç—É
                } else if (feature.properties['–°–µ—Ä–≤—ñ—Ç—É—Ç'] === false) {
                    fillColor = "#eb6e6e"; // –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –±–µ–∑ —Å–µ—Ä–≤—ñ—Ç—É—Ç—É
                } else {
                    fillColor = "black"; // –ß–æ—Ä–Ω–∏–π –¥–ª—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –¥–∞–Ω–∏—Ö
                }

                return {
                    fillColor: fillColor,
                    color: fillColor, // –ö–æ–ª—ñ—Ä –æ–±–≤–µ–¥–µ–Ω–Ω—è
                    weight: 2, // –¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–µ–¥–µ–Ω–Ω—è
                    opacity: 1, // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –æ–±–≤–µ–¥–µ–Ω–Ω—è
                    fillOpacity: 0.2 // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
                };
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup(`
                    <h4 style="margin: 5px 0; font-size: 16px; color: #d9534f;">${feature.properties["landuse.cadnum"] || feature.properties.cadnum || feature.properties.Kad || 'Unknown'}</h4>
                    <b>–ü–ª–æ—â–∞:</b> ${feature.properties.area || feature.properties["_AS____________________________________________________"] || 'Unknown'}<br>
                    <b>–°–µ—Ä–≤—ñ—Ç—É—Ç:</b> ${feature.properties['–°–µ—Ä–≤—ñ—Ç—É—Ç'] === true ? "–¢–∞–∫" : feature.properties['–°–µ—Ä–≤—ñ—Ç—É—Ç'] === false ? "–ù—ñ" : "Unknown"}<br>
                    <b>–ö–æ–¥:</b> ${feature.properties.purpose_code || 'Unknown'}<br>
                    <b>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</b> ${feature.properties.purpose || 'Unknown'}<br>
                    <b>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:</b> ${feature.properties.use || feature.properties.for || feature.properties["_TX__________________________________________________________________________"] || 'Unknown'}<br>
                    <b>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</b> ${feature.properties.category || 'Unknown'}<br>
                    <b>–Æ—Ä–∏–¥–∏—á–∫–∞:</b> ${feature.properties['–§–∞–π–ª'] || feature.properties.ur || 'ownership'}<br>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">    
                        <div>üîó<a href="https://e.land.gov.ua/back/cadaster/?cad_num=${feature.properties["landuse.cadnum"]}" target="_blank" style="color: blue; text-decoration: underline;"> –î–µ—Ç–∞–ª—ñ –≤ –î–ó–ö</a></div>
                        <div><button class="pdfbutton" onclick="openPDF('${feature.properties["landuse.cadnum"] || feature.properties.cadnum}')">–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ PDF</button></div>
                    </div>
                  `);
            }
        }); 





    //----------------------------------------------------------------shari –∫–æ–Ω—Ç—Ä–æ–ª—å —à–∞—Ä—ñ–≤-----------------------------------------------------------------
                    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Ä–µ–≤–∞ —à–∞—Ä—ñ–≤
            var baseTree = {
                label: "<b>–ë–∞–∑–æ–≤—ñ –∫–∞—Ä—Ç–∏</b>",
                children: [
                    { label: "OpenStreetMap", layer: osmLayer, radioGroup: "basemap" },
                    { label: "White Map", layer: WhiteLayer, radioGroup: "basemap" },
                    { label: "Google Map", layer: googleLayer, radioGroup: "basemap" },
                    { label: "Topo Map", layer: topoLayer, radioGroup: "basemap" },
                ]
            };
            // –î–µ—Ä–µ–≤–æ —à–∞—Ä—ñ–≤
            var overlaysTree = {
                label: "<b>–®–∞—Ä–∏</b>",
                selectAllCheckbox: true,  // –î–æ–¥–∞—î —á–µ–∫–±–æ–∫—Å –¥–ª—è –≤–∏–±–æ—Ä—É –≤—Å—ñ—Ö —à–∞—Ä—ñ–≤
                children: [
                    { label: "–ù–∞—à—ñ –¥—ñ–ª—è–Ω–∫–∏", layer: small_14_01 },
                    { 
                        label: "<b>–ü—Ä–∏—Ä–æ–¥–æ–æ—Ö–æ—Ä–æ–Ω–Ω—ñ –¥–∞–Ω—ñ</b>", 
                        collapsed: false,  // ‚ùó –ó–≥–æ—Ä–Ω—É—Ç–∞ –≥—Ä—É–ø–∞
                        children: [
                            { label: "<span>–ü—Ç–∞—Ö–∏, –∫–∞–∂–∞–Ω–∏ (–ß–ö)</span>", layer: animalLayer },
                            { label: "<span>–†–∞–º—Å–∞—Ä—Å—å–∫–∞ –∫–æ–Ω–≤–µ–Ω—Ü—ñ—è</span>", layer: waterPolyLayer },
                            { label: "<span>–ü—Ä–∏—Ä–æ–¥–Ω–æ-–∑–∞–ø–æ–≤—ñ–¥–Ω–∏–π —Ñ–æ–Ω–¥</span>", layer: dzkPzfLayer },
                            { label: "<span>–°–º–∞—Ä–∞–≥–¥–æ–≤–∞ –º–µ—Ä–µ–∂–∞</span>", layer: emeraldLayer }
                        ]
                    },
                    { 
                        label: "<b>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –ø–æ–¥—ñ–ª</b>", 
                        collapsed: false,
                        children: [
                        { label: "–ú–µ–∂—ñ –£–∫—Ä–∞—ó–Ω–∏", layer: borderLayer },
                        { label: "–ú–µ–∂—ñ –æ–±–ª–∞—Å—Ç–µ–π", layer: oblastLayer },
                        { label: "–ú–µ–∂—ñ —Ä–∞–π–æ–Ω—ñ–≤", layer: raionLayer },
                        { label: "–ú–µ–∂—ñ –û–¢–ì", layer: otgLayer },
                        { label:  `–ö–∞–¥–∞—Å—Ç—Ä <button class="filter-button2" onclick="addfiltermenu()" id="filterToggle">‚öôÔ∏è</button>`, layer: vectorTileLayer}, // –¥–æ —Ü—å–æ–≥–æ —à–∞—Ä—É —Ñ—ñ–ª—å—Ç—Ä–∏
                        { label: "–ö–∞–¥–∞—Å—Ç—Ä –ø—ñ–¥–∫–ª–∞–¥–∫–∞", layer: cadastrLayer },
                        ]
                    },
                    
                ]
            };
            
             // —Ç—Ä–æ—Ö–∏ –∑–∞—á–µ–∫–∞—î–º–æ, —â–æ–± DOM –¥–µ—Ä–µ–≤–∞ —Ç–æ—á–Ω–æ –≤—Å—Ç–∏–≥ –∑'—è–≤–∏—Ç–∏—Å—å

            // –î–æ–¥–∞—î–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—å —à–∞—Ä—ñ–≤
            var layerControl = L.control.layers.tree(baseTree, overlaysTree, {
                namedToggle: false,  
                selectorBack: false, 
                closedSymbol: "‚ñ∂",  
                openedSymbol: "‚ñº",  
                collapsed: true
            }).addTo(map);

            function addLayersAfterAnimation() {
                setTimeout(() => {
                    // –î–æ–¥–∞—î–º–æ —à–∞—Ä–∏ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
                    
                    vectorTileLayer.addTo(map);
                    // geoJsonClusterGroup.addTo(map);  // —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
                    borderLayer.addTo(map);
                    
                    
                }, 1000); // –∑–∞—Ç—Ä–∏–º–∫–∞ 4 —Å–µ–∫—É–Ω–¥–∏ (—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∞–Ω—ñ–º–∞—Ü—ñ—ó)
            }
                            
            addLayersAfterAnimation();

            


                // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–µ–Ω—é
           

})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));
})
.catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON (–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è):', error));

}
                                   
    </script>

    <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —á–µ—Ä–µ–∑ IIFE –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä—É
    <script>
        (async function() {
            window.Pbf = (await import("https://cdn.skypack.dev/pbf")).default;
            window.VectorTile = (await import("https://cdn.skypack.dev/@mapbox/vector-tile")).VectorTile;
        })();
    </script>
    
    <script defer src="./script-cadastr.js"></script>-->
</body>
</html>



